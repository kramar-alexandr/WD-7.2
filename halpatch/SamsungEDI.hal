external procedure ExtractObj(string,var Integer,var string);external function val AbsoluteVal(val);external function roundmode SetRoundModeD(Integer);external function Boolean IsDigit(string);external procedure ExtractObjWithSeparator(string,string,Boolean,var Integer,var string);external procedure XmlXlsxWorkBegin(string,string);external procedure CreateSheetsXLSX(integer,array string,string,integer,boolean);external procedure EndSheet(integer,string,integer);external procedure SetSheetsCols(integer,array val,array integer,string);external procedure BeginSheetData(integer,string);external procedure EndSheetData(integer,string);external procedure BeginRow(integer,string,integer,integer,val);external procedure EndRow(integer,string,var integer);external procedure StringCell(integer,string,var integer,integer,integer,string,var array string,var integer,var integer);external procedure NumericCell(integer,string,var integer,integer,integer,val);external procedure EmptyCell(integer,string,var integer,integer,integer,integer);external procedure MergeCells(integer,string,array string,integer);external procedure FillSharedStrings(string,array string,integer,integer,array string);external procedure ConvertToXLSX(string,boolean);external function string 10 GetStringCellNum(integer,integer);SetLangMode(LangRussian,"UKR",0);global function string 255 NewM4PadString(string instr,Integer padlen,string padchar,Boolean padleft)BEGIN  string 255 tstr,t2;  Integer i;  Integer toff;    toff = 0;  for (i = 1; i<=padlen ;i=i+1) begin tstr = tstr & padchar; end;  if (padleft) then begin    tstr = tstr & instr;    tstr = Right(tstr,(len(tstr)-len(instr)));      end else begin    t2 = tstr;    tstr = instr;    tstr = tstr & t2;    tstr = Left(tstr,padlen);  end;    NewM4PadString = tstr;  RETURN;END;function boolean IsStringNumeric(string s)begin  integer i;  boolean res;    res = true;  for (i=0;i<len(s);i=i+1) begin    if (IsDigit(mid(s,i,1))==false) then begin      res = false;      i = len(s)+1;    end;  end;    IsStringNumeric = res;  return;end;function boolean SamsungSalesOldRun(record RcVc RepSpec,record SamsungSettingsBlock SFtpb,var string outfile)begin  record IVVc IVr;  record INVc INr;  row IVVc IVrw;  date sd,ed;  time curtime;  string 255 filename,senderCode,locations;  boolean TrHs,testf,initfile,res;  string 20 timeStamp;  area ames;  integer i,rwcnt;  string 4 linefeed,padchar;		 res = false;	 outfile = "";	 linefeed = Chr(10); 	 padchar = " ";	 	 sd = RepSpec.sStartDate;	 ed = RepSpec.sEndDate;	 locations = SFtpb.Locations;	 if (blank(locations)) then begin	   goto LSamsungSalesOldRun;	 end; 		 if (BlankDate(sd)) then begin		 sd = CurrentDate;	 end;	 if (BlankDate(ed)) then begin		 ed = CurrentDate;	 end;	 LogText(0,"Period " & sd & ":" & ed);		 timeStamp = DateToString(CurrentDate,"YYYYMMDD");	 curtime = CurrentTime;	 if (len(GetHour(curtime))==1) then begin	   timeStamp = timeStamp & "0" & GetHour(curtime);	 end else begin	   timeStamp = timeStamp & GetHour(curtime);	 end;	 if (len(GetMinute(curtime))==1) then begin	   timeStamp = timeStamp & "0" & GetMinute(curtime);	 end else begin	   timeStamp = timeStamp & GetMinute(curtime);	 end;	 if (len(GetSecond(curtime))==1) then begin	   timeStamp = timeStamp & "0" & GetSecond(curtime);	 end else begin	   timeStamp = timeStamp & GetSecond(curtime);	 end;	 senderCode = SFtpb.SenderCode;	 filename = "PCISTD2.C962." & senderCode & "." & timeStamp & ".txt";	 outfile = filename;	 CreateFile(filename);	 CloseFile;	 	 //Header   AddTextToArea(NewM4PadString("C962",4,padchar,false), ames); //SECCOD   AddTextToArea(NewM4PadString("S",4,padchar,false), ames); //DOCCAT   AddTextToArea(NewM4PadString(SFtpb.SenderName,50,padchar,false), ames); //SNDNAM   AddTextToArea(NewM4PadString("ST",2,padchar,false), ames); //SNDTYP   AddTextToArea(NewM4PadString(senderCode,50,padchar,false), ames); //SNDCOD   AddTextToArea(NewM4PadString(SFtpb.SalesNextDocNum,14,padchar,false), ames); //DOCNUM //should be some increment???   AddTextToArea(NewM4PadString(DateToString(CurrentDate,"YYYYMMDD"),8,padchar,false), ames); //DOCDAT   AddTextToArea("Z" & linefeed, ames); //HDRFLG	 	 TrHs = true;	 IVr.TransDate = sd;	 While(LoopKey("TransDate",IVr,1,TrHs)) begin	   testf = true;	   if (blank(IVr.Location) or SetinSet(IVr.Location,locations)==false) then begin testf = false; end;	 	 if (IVr.TransDate<sd) then begin testf = false; end;	 	 if (IVr.TransDate>ed) then begin TrHs = false; testf = false; end;	 	 if (testf) then begin		 	 //if(IVr.InvType==kInvoiceTypeCredit or IVr.InvType==kInvoiceTypeCreditSpecialSales)then begin sign=-1; end;			  rwcnt = MatRowCnt(IVr);			  for(i=0;i<rwcnt;i=i+1) begin				  MatRowGet(IVr,i,IVrw);				  if (IVrw.stp==kInvoiceRowTypeNormal and NonBlank(IVrw.ArtCode)) then begin				 	  INr.Code = IVrw.ArtCode;				 	  ReadFirstMain(INr,1,true);				 	  if (nonblank(INr.EUCodex)) then begin    				 	if (initfile==false) then begin                initfile = true;              end;  				 	  AddTextToArea(NewM4PadString(senderCode,10,padchar,false), ames); //PTNCOD  				 	  AddTextToArea(NewM4PadString(DateToString(IVr.TransDate,"YYYYMMDD"),8,padchar,false), ames); //ITMDAT  				 	  AddTextToArea(NewM4PadString("",8,padchar,false), ames); //STADAT  				 	  AddTextToArea(NewM4PadString("",8,padchar,false), ames); //ENDDAT  				 	  AddTextToArea(NewM4PadString(INr.EUCodex,20,padchar,false), ames); //SECMOD  				 	  AddTextToArea(NewM4PadString(INr.BarCode,20,padchar,false), ames); //EANUPC  				 	  AddTextToArea(NewM4PadString(INr.Code,30,padchar,false), ames); //PTNMOD  				 	  AddTextToArea(NewM4PadString(IVr.Location,30,padchar,false), ames); //LOCCOD  				 	  AddTextToArea(NewM4PadString("ST",2,padchar,false), ames); //LOCTYP  				 	  AddTextToArea(NewM4PadString("",20,padchar,false), ames); //CHNSRC  				 	  AddTextToArea(NewM4PadString("",20,padchar,false), ames); //CHNCAT  				 	  AddTextToArea(NewM4PadString("",20,padchar,false), ames); //PTN2CD  				 	  AddTextToArea(NewM4PadString("",20,padchar,false), ames); //PTNAGT  				 	  if (IVr.InvType==kInvoiceTypeCredit or IVr.InvType==kInvoiceTypeCreditSpecialSales or IVrw.Quant<0) then begin  				 	    AddTextToArea(NewM4PadString("SR",10,padchar,false), ames); //QTYTYP  				 	  end else begin  				 	    AddTextToArea(NewM4PadString("SN",10,padchar,false), ames); //QTYTYP  				 	  end;  				 	  AddTextToArea(NewM4PadString(AbsoluteVal(IVrw.Quant),10,padchar,false), ames); //QTY  				 	  AddTextToArea(NewM4PadString("",10,padchar,false), ames); //AMT  				 	  AddTextToArea(NewM4PadString("",3,padchar,false), ames); //CUR  				 	  AddTextToArea(NewM4PadString("",50,padchar,false), ames); //RESRV1  				 	  AddTextToArea(NewM4PadString("",50,padchar,false), ames); //RESRV2  				 	  AddTextToArea(NewM4PadString("",50,padchar,false), ames); //RESRV3  				 	  AddTextToArea(NewM4PadString("",50,padchar,false), ames); //RESRV4  				 	  AddTextToArea("Z" & linefeed, ames); //ITMFLG  				 	  end;				  end;			 end;  			 end;	 end;	 	 if (initfile) then begin	   WriteAreaToFile(ames,filename,0);	   res = true;	 end;	 LSamsungSalesOldRun:;  SamsungSalesOldRun = res;  return;end;/*global updating procedure SamsungSendFilesToFtpMn(record RcVc RepSpec)begin  string 255 tstr,outsalesfile;  Boolean sendf;  record SamsungSettingsBlock SFtpb;    BlockLoad(SFtpb);  if (Blank(SFtpb.HostIP) or Blank(SFtpb.DirName) or Blank(SFtpb.Port)) then begin	 goto LSamsungSendFilesToFtpMn;	end;	if (SFtpb.SalesNextDocNum<=0) then begin	  SFtpb.SalesNextDocNum = 1;	end;		if (SamsungSalesOldRun(RepSpec,SFtpb,outsalesfile)) then begin	  SFtpb.SalesNextDocNum = SFtpb.SalesNextDocNum + 1;	  sendf = true;	end;	if (sendf) then begin	  tstr = SFtpb.HostIP & " " & SFtpb.Port & " ";  	if (NonBlank(SFtpb.Login)) then begin  	  tstr = tstr & SFtpb.Login & " ";  	end else begin  	  tstr = tstr & "anonymous ";  	end;  	if (NonBlank(SFtpb.Password)) then begin  	  tstr = tstr & SFtpb.Password & " ";  	end else begin  	  tstr = tstr & "password ";  	end;  	tstr = tstr & SFtpb.DirName & " " & outsalesfile;  	  	millisleep(500);  	RunProgram("./ftptransfer.sh", tstr);	end;		BlockStore(SFtpb);   LSamsungSendFilesToFtpMn:;      return;end;*/global updating procedure SamsungSendFilesByMailEXCELMn(record RcVc RepSpec)begin  record SamsungSettingsBlock SFtpb;  record IVcashVc IVcashr;  record INVc INr;  record SysFormatBlock SysFormatRec;  record ItemStatusVc ISr;  row IVcashVc IVcashrw;  date sd,ed;  string 255 locations,mailSubject,tstr,curindex;  boolean TrHs,testf,proccedf;  string 30 salesdate,itemCode,identificator;  integer i,rwcnt,pos,invoiceCnt;  vector val qtySetCodes,qtyAccesSumsCodes,qtyAccesOthersCodes;  vector val qtySetList,qtyAccesSumsList,qtyAccesOthersList;  vector LongInt serNrSetCodes, serNrAccesSumsCodes, serNrAccesOthersCodes;  vector val priceSetCodes, priceAccesSumsCodes, priceAccesOthersCodes;  array string 255 indexes;  val tval;    array string 10 sheetNames;	array val sheetColls;	array integer sheetCollsOutLvl;	array string 21 mergeCell;	string 255 fileToSave;	integer qtyOfSheets,sheetnum,rownum,colnum,style,qtyOfEmpStr;	array string 100 SharedStrings;	integer numOfUniqueSharedStrings,numOfSharedStrings,qtyMergeCell;	string 16 reportName;  array integer lvlArray;  array string 255 mas;    BlockLoad(SFtpb);  if (blank(SFtpb.Locations) or blank(SFtpb.DirName)) then begin    goto LSamsungSendFilesByMailEXCELMn;  end;  sd = RepSpec.sStartDate;  ed = RepSpec.sEndDate;  locations = SFtpb.Locations; //for now only one location is allowed    if (BlankDate(sd)) then begin    sd = CurrentDate;  end;  if (BlankDate(ed)) then begin   ed = sd;  end;  LogText(0,"Period " & sd & ":" & ed);     salesdate = DateToString(sd,"YYYYMMDD");     mailSubject = "[EDI_SELL_OUT] " & SFtpb.SenderName & " " & salesdate;  TrHs = true;  IVcashr.TransDate = sd;  invoiceCnt = 0;  While(LoopKey("TransDate",IVcashr,1,TrHs)) begin    testf = true;    if (blank(IVcashr.Location) or IVcashr.Location!=locations) then begin testf = false; end;    if (IVcashr.TransDate<sd) then begin testf = false; end;    if (IVcashr.TransDate>ed) then begin TrHs = false; testf = false; end;    if (testf) then begin      invoiceCnt = invoiceCnt + 1;      rwcnt = MatRowCnt(IVcashr);      for(i=0;i<rwcnt;i=i+1) begin        MatRowGet(IVcashr,i,IVcashrw);        if (IVcashrw.stp==kInvoiceRowTypeNormal and NonBlank(IVcashrw.ArtCode)) then begin          INr.Code = IVcashrw.ArtCode;          ReadFirstMain(INr,1,true);          if (INr.Terminated==1) then begin testf=false; end;          if (testf) then begin            if (INr.Group=="SAMSU") then begin //SET              if ((NonBlank(IVcashrw.SerialNr) or NonBlank(IVcashrw.IMEI)) /*and                  (NonBlank(INr.EUCodex) or (NonBlank(INr.BarCode) and len(INr.BarCode)==13) and IsStringNumeric(INr.BarCode))*/) then begin                proccedf = false;                if (NonBlank(IVcashrw.IMEI)) then begin                  curindex = IVcashrw.ArtCode & ";" & IVcashrw.IMEI;                  proccedf = true;                end else begin                  curindex = IVcashrw.ArtCode & ";" & IVcashrw.SerialNr;                  proccedf = true;                end;                if (proccedf) then begin                  //vectors for sale                  if (IVcashrw.Quant>0) then begin                    qtySetCodes[curindex] = qtySetCodes[curindex] + IVcashrw.Quant;                    serNrSetCodes[curindex] = IVcashr.SerNr;                    priceSetCodes[curindex] = IVcashrw.Price;                  end else begin                    qtySetCodes[curindex] = qtySetCodes[curindex] - IVcashrw.Quant;                  end;                end;                                //vector for inventory                if (IVcashrw.Quant>0) then begin                  qtySetList[IVcashrw.ArtCode] = qtySetList[IVcashrw.ArtCode] + IVcashrw.Quant;                end else begin                  qtySetList[IVcashrw.ArtCode] = qtySetList[IVcashrw.ArtCode] - IVcashrw.Quant;                end;              end;            end else begin //Accessory              if (INr.Group=="SMG_A") then begin                proccedf = false;                if (NonBlank(INr.EUCodex)) then begin                  curindex = IVcashrw.ArtCode & ";" & INr.EUCodex;                  proccedf = true;                end else begin                  /*if (NonBlank(INr.BarCode) and len(INr.BarCode)==13 and IsStringNumeric(INr.BarCode)) then begin                    curindex = IVcashrw.ArtCode & ";" & INr.BarCode;                    proccedf = true;                  end else begin*/                    curindex = IVcashrw.ArtCode & ";" & IVcashrw.ArtCode;                    proccedf = true;                  //end;                end;                if (proccedf) then begin                  //vectors for sale                  if (IVcashrw.Quant>0) then begin                    qtyAccesSumsCodes[curindex] = qtyAccesSumsCodes[curindex] + IVcashrw.Quant;                    serNrAccesSumsCodes[curindex] = IVcashr.SerNr;                    priceAccesSumsCodes[curindex] = IVcashrw.Price;                  end else begin                    qtyAccesSumsCodes[curindex] = qtyAccesSumsCodes[curindex] - IVcashrw.Quant;                  end;                end;                                //vector for inventory                if (IVcashrw.Quant>0) then begin                  qtyAccesSumsList[IVcashrw.ArtCode] = qtyAccesSumsList[IVcashrw.ArtCode] + IVcashrw.Quant;                end else begin                  qtyAccesSumsList[IVcashrw.ArtCode] = qtyAccesSumsList[IVcashrw.ArtCode] - IVcashrw.Quant;                end;                  	                      end else begin                curindex = IVcashrw.ArtCode;                //vectors for sale                if (IVcashrw.Quant>0) then begin                  qtyAccesOthersCodes[curindex] = qtyAccesOthersCodes[curindex] + IVcashrw.Quant;                  serNrAccesOthersCodes[curindex] = IVcashr.SerNr;                  priceAccesOthersCodes[curindex] = IVcashrw.Price;                end else begin                  qtyAccesOthersCodes[curindex] = qtyAccesOthersCodes[curindex] - IVcashrw.Quant;                end;                                //vector for inventory                if (IVcashrw.Quant>0) then begin                  qtyAccesOthersList[IVcashrw.ArtCode] = qtyAccesOthersList[IVcashrw.ArtCode] + IVcashrw.Quant;                 end else begin                  qtyAccesOthersList[IVcashrw.ArtCode] = qtyAccesOthersList[IVcashrw.ArtCode] - IVcashrw.Quant;                end;              end;            end;          end;        end;      end;  	    end;  end;    reportName = "SamsungSendFilesByMailEXCEL";  if (windowsmode==1) then begin    fileToSave = "Samsunglsx.xlsx";  end else begin    fileToSave = "/Samsungxlsx.xlsx";  end;  deletefolder(Left(fileToSave,(len(fileToSave) - 5)));  qtyOfSheets = 3;  sheetNames[0] = "SET";  sheetNames[1] = "Accessory";  sheetNames[2] = "Inventory";    numOfUniqueSharedStrings = 0;  numOfSharedStrings = 0;    XmlXlsxWorkBegin(fileToSave,reportName);  CreateSheetsXLSX(qtyOfSheets,sheetNames,fileToSave,0,false);      colnum = 0;    sheetColls[colnum] = 21;    colnum = colnum + 1;    sheetColls[colnum] = 18.28515625;    colnum = colnum + 1;    sheetColls[colnum] = 33;    colnum = colnum + 1;    sheetColls[colnum] = 28;    colnum = colnum + 1;    sheetColls[colnum] = 21.42578125;    colnum = colnum + 1;    sheetColls[colnum] = 16.42578125;    colnum = colnum + 1;    sheetColls[colnum] = 28.140625;    colnum = colnum + 1;    sheetColls[colnum] = 14.140625;        qtyMergeCell = 0;    sheetnum = 1;    SetSheetsCols(sheetnum,sheetColls,lvlArray,fileToSave);    BeginSheetData(sheetnum,fileToSave);      rownum = 1;      colnum = 1;      BeginRow(sheetnum,fileToSave,rownum,0,blankval); //SET header        style = 7;				StringCell(sheetnum,fileToSave,colnum,rownum,style,SFtpb.SenderCode,SharedStrings,numOfUniqueSharedStrings,numOfSharedStrings);        StringCell(sheetnum,fileToSave,colnum,rownum,style,salesdate,SharedStrings,numOfUniqueSharedStrings,numOfSharedStrings);        style = 8;        NumericCell(sheetnum,fileToSave,colnum,rownum,style,invoiceCnt+1); //Visitors        NumericCell(sheetnum,fileToSave,colnum,rownum,style,invoiceCnt); //Customers      EndRow(sheetnum,fileToSave,rownum);      colnum = 1;      BeginRow(sheetnum,fileToSave,rownum,0,blankval);        style = 6;        StringCell(sheetnum,fileToSave,colnum,rownum,style,"Серийный номер",SharedStrings,numOfUniqueSharedStrings,numOfSharedStrings);        StringCell(sheetnum,fileToSave,colnum,rownum,style,"Цена товара",SharedStrings,numOfUniqueSharedStrings,numOfSharedStrings);        StringCell(sheetnum,fileToSave,colnum,rownum,style,"ФИО Покупателя",SharedStrings,numOfUniqueSharedStrings,numOfSharedStrings);        StringCell(sheetnum,fileToSave,colnum,rownum,style,"Номер телефона покупателя",SharedStrings,numOfUniqueSharedStrings,numOfSharedStrings);        StringCell(sheetnum,fileToSave,colnum,rownum,style,"Адрес электронной почты",SharedStrings,numOfUniqueSharedStrings,numOfSharedStrings);        StringCell(sheetnum,fileToSave,colnum,rownum,style,"Номер чека",SharedStrings,numOfUniqueSharedStrings,numOfSharedStrings);        StringCell(sheetnum,fileToSave,colnum,rownum,style,"Номер участника программы",SharedStrings,numOfUniqueSharedStrings,numOfSharedStrings);        StringCell(sheetnum,fileToSave,colnum,rownum,style,"Номер купона",SharedStrings,numOfUniqueSharedStrings,numOfSharedStrings);      EndRow(sheetnum,fileToSave,rownum);      GetVectorTags(qtySetCodes,indexes);      for(i=0;i<indexes.length;i=i+1) begin //SET items        curindex = indexes[i];        pos = 0;        ExtractObjWithSeparator(";",curindex,false,pos,itemCode);        ExtractObjWithSeparator(";",curindex,false,pos,identificator);        if (qtySetCodes[curindex]>0) then begin          colnum = 1;            BeginRow(sheetnum,fileToSave,rownum,0,blankval);            style = 4;            StringCell(sheetnum,fileToSave,colnum,rownum,style,identificator,SharedStrings,numOfUniqueSharedStrings,numOfSharedStrings);            //tstr = ValToString(priceSetCodes[curindex],M4Val,"",SysFormatRec.decimalPt,0);            style = 5;            NumericCell(sheetnum,fileToSave,colnum,rownum,style,priceSetCodes[curindex]);            style = 4;            StringCell(sheetnum,fileToSave,colnum,rownum,style,"",SharedStrings,numOfUniqueSharedStrings,numOfSharedStrings);            StringCell(sheetnum,fileToSave,colnum,rownum,style,"",SharedStrings,numOfUniqueSharedStrings,numOfSharedStrings);            StringCell(sheetnum,fileToSave,colnum,rownum,style,"",SharedStrings,numOfUniqueSharedStrings,numOfSharedStrings);            StringCell(sheetnum,fileToSave,colnum,rownum,style,serNrSetCodes[curindex],SharedStrings,numOfUniqueSharedStrings,numOfSharedStrings);            StringCell(sheetnum,fileToSave,colnum,rownum,style,"",SharedStrings,numOfUniqueSharedStrings,numOfSharedStrings);            StringCell(sheetnum,fileToSave,colnum,rownum,style,"",SharedStrings,numOfUniqueSharedStrings,numOfSharedStrings);          EndRow(sheetnum,fileToSave,rownum);        end;      end;    EndSheetData(sheetnum,fileToSave);    MergeCells(sheetnum,fileToSave,mergeCell,qtyMergeCell);    EndSheet(sheetnum,fileToSave,0);        ClearArray(sheetColls);    colnum = 0;    sheetColls[colnum] = 16.28515625;    colnum = colnum + 1;    sheetColls[colnum] = 11.85546875;    colnum = colnum + 1;    sheetColls[colnum] = 12.28515625;    colnum = colnum + 1;    sheetColls[colnum] = 33.140625;    colnum = colnum + 1;    sheetColls[colnum] = 28;    colnum = colnum + 1;    sheetColls[colnum] = 8.85546875;    colnum = colnum + 1;    sheetColls[colnum] = 60.85546875;    colnum = colnum + 1;    sheetColls[colnum] = 12.140625;    colnum = colnum + 1;    sheetColls[colnum] = 28.140625;    colnum = colnum + 1;    sheetColls[colnum] = 14.140625;        qtyMergeCell = 0;    sheetnum = sheetnum + 1;    SetSheetsCols(sheetnum,sheetColls,lvlArray,fileToSave);    BeginSheetData(sheetnum,fileToSave);      rownum = 1;      colnum = 1;      BeginRow(sheetnum,fileToSave,rownum,0,blankval); //Accessory header        style = 9;        StringCell(sheetnum,fileToSave,colnum,rownum,style,"Код модели",SharedStrings,numOfUniqueSharedStrings,numOfSharedStrings);        StringCell(sheetnum,fileToSave,colnum,rownum,style,"Количество продаж",SharedStrings,numOfUniqueSharedStrings,numOfSharedStrings);        StringCell(sheetnum,fileToSave,colnum,rownum,style,"Цена товара",SharedStrings,numOfUniqueSharedStrings,numOfSharedStrings);        StringCell(sheetnum,fileToSave,colnum,rownum,style,"ФИО Покупателя",SharedStrings,numOfUniqueSharedStrings,numOfSharedStrings);        StringCell(sheetnum,fileToSave,colnum,rownum,style,"Номер телефона покупателя",SharedStrings,numOfUniqueSharedStrings,numOfSharedStrings);        StringCell(sheetnum,fileToSave,colnum,rownum,style,"Бренд",SharedStrings,numOfUniqueSharedStrings,numOfSharedStrings);        StringCell(sheetnum,fileToSave,colnum,rownum,style,"Адрес электронной почты",SharedStrings,numOfUniqueSharedStrings,numOfSharedStrings);        StringCell(sheetnum,fileToSave,colnum,rownum,style,"Номер чека",SharedStrings,numOfUniqueSharedStrings,numOfSharedStrings);        StringCell(sheetnum,fileToSave,colnum,rownum,style,"Номер участника программы",SharedStrings,numOfUniqueSharedStrings,numOfSharedStrings);        StringCell(sheetnum,fileToSave,colnum,rownum,style,"Номер купона",SharedStrings,numOfUniqueSharedStrings,numOfSharedStrings);      EndRow(sheetnum,fileToSave,rownum);      GetVectorTags(qtyAccesSumsCodes,indexes); //Accessory Samsung      for(i=0;i<indexes.length;i=i+1) begin        curindex = indexes[i];        pos = 0;        ExtractObjWithSeparator(";",curindex,false,pos,itemCode);        ExtractObjWithSeparator(";",curindex,false,pos,identificator);        if (qtyAccesSumsCodes[curindex]>0) then begin          colnum = 1;            BeginRow(sheetnum,fileToSave,rownum,0,blankval);            style = 4;            StringCell(sheetnum,fileToSave,colnum,rownum,style,identificator,SharedStrings,numOfUniqueSharedStrings,numOfSharedStrings);            style = 5;            NumericCell(sheetnum,fileToSave,colnum,rownum,style,qtyAccesSumsCodes[curindex]);            NumericCell(sheetnum,fileToSave,colnum,rownum,style,priceAccesSumsCodes[curindex]);            //tstr = ValToString(priceAccesSumsCodes[curindex],M4Val,"",SysFormatRec.decimalPt,0);            style = 4;            StringCell(sheetnum,fileToSave,colnum,rownum,style,"",SharedStrings,numOfUniqueSharedStrings,numOfSharedStrings);            StringCell(sheetnum,fileToSave,colnum,rownum,style,"",SharedStrings,numOfUniqueSharedStrings,numOfSharedStrings);            StringCell(sheetnum,fileToSave,colnum,rownum,style,"Samsung",SharedStrings,numOfUniqueSharedStrings,numOfSharedStrings);            StringCell(sheetnum,fileToSave,colnum,rownum,style,"",SharedStrings,numOfUniqueSharedStrings,numOfSharedStrings);            StringCell(sheetnum,fileToSave,colnum,rownum,style,serNrAccesSumsCodes[curindex],SharedStrings,numOfUniqueSharedStrings,numOfSharedStrings);            StringCell(sheetnum,fileToSave,colnum,rownum,style,"",SharedStrings,numOfUniqueSharedStrings,numOfSharedStrings);            StringCell(sheetnum,fileToSave,colnum,rownum,style,"",SharedStrings,numOfUniqueSharedStrings,numOfSharedStrings);          EndRow(sheetnum,fileToSave,rownum);        end;      end;      GetVectorTags(qtyAccesOthersCodes,indexes); //Accessory Others      for(i=0;i<indexes.length;i=i+1) begin        curindex = indexes[i];        pos = 0;        //ExtractObjWithSeparator(";"curindex,false,pos,itemCode);        //ExtractObjWithSeparator(";",curindex,false,pos,identificator);        if (qtyAccesOthersCodes[curindex]>0) then begin          colnum = 1;            BeginRow(sheetnum,fileToSave,rownum,0,blankval);            style = 4;            StringCell(sheetnum,fileToSave,colnum,rownum,style,curindex,SharedStrings,numOfUniqueSharedStrings,numOfSharedStrings);            style = 5;            NumericCell(sheetnum,fileToSave,colnum,rownum,style,qtyAccesOthersCodes[curindex]);            NumericCell(sheetnum,fileToSave,colnum,rownum,style,priceAccesOthersCodes[curindex]);            //tstr = ValToString(priceAccesOthersCodes[curindex],M4Val,"",SysFormatRec.decimalPt,0);            style = 4;            StringCell(sheetnum,fileToSave,colnum,rownum,style,"",SharedStrings,numOfUniqueSharedStrings,numOfSharedStrings);            StringCell(sheetnum,fileToSave,colnum,rownum,style,"",SharedStrings,numOfUniqueSharedStrings,numOfSharedStrings);            StringCell(sheetnum,fileToSave,colnum,rownum,style,"Others",SharedStrings,numOfUniqueSharedStrings,numOfSharedStrings);            StringCell(sheetnum,fileToSave,colnum,rownum,style,"",SharedStrings,numOfUniqueSharedStrings,numOfSharedStrings);            StringCell(sheetnum,fileToSave,colnum,rownum,style,serNrAccesOthersCodes[curindex],SharedStrings,numOfUniqueSharedStrings,numOfSharedStrings);            StringCell(sheetnum,fileToSave,colnum,rownum,style,"",SharedStrings,numOfUniqueSharedStrings,numOfSharedStrings);            StringCell(sheetnum,fileToSave,colnum,rownum,style,"",SharedStrings,numOfUniqueSharedStrings,numOfSharedStrings);          EndRow(sheetnum,fileToSave,rownum);        end;      end;    EndSheetData(sheetnum,fileToSave);    MergeCells(sheetnum,fileToSave,mergeCell,qtyMergeCell);    EndSheet(sheetnum,fileToSave,0);        ClearArray(sheetColls);    colnum = 0;    sheetColls[colnum] = 18.5703125;    colnum = colnum + 1;    sheetColls[colnum] = 22.42578125;    colnum = colnum + 1;    sheetColls[colnum] = 15.28515625;        qtyMergeCell = 0;    sheetnum = sheetnum + 1;    SetSheetsCols(sheetnum,sheetColls,lvlArray,fileToSave);    BeginSheetData(sheetnum,fileToSave);      rownum = 1;      colnum = 1;      BeginRow(sheetnum,fileToSave,rownum,0,blankval); //Inventory header        style = 3;        StringCell(sheetnum,fileToSave,colnum,rownum,style,"Код модели",SharedStrings,numOfUniqueSharedStrings,numOfSharedStrings);        StringCell(sheetnum,fileToSave,colnum,rownum,style,"Кол-во остатков",SharedStrings,numOfUniqueSharedStrings,numOfSharedStrings);        StringCell(sheetnum,fileToSave,colnum,rownum,style,"Тип продукта",SharedStrings,numOfUniqueSharedStrings,numOfSharedStrings);        StringCell(sheetnum,fileToSave,colnum,rownum,style,"Бренд",SharedStrings,numOfUniqueSharedStrings,numOfSharedStrings);      EndRow(sheetnum,fileToSave,rownum);            ISr.Location = locations;      TrHs = true;      while (LoopKey("Location",ISr,1,TrHs)) begin        if (ISr.Location!=locations) then begin TrHs=false; end;        if (TrHs) then begin          INr.Code = ISr.Code;          if (ReadFirstMain(INr,1,true) and INr.Terminated==0) then begin            if (INr.Group=="SAMSU") then begin  //Inventory Set-Samsung              tval = qtySetList[ISr.Code];              if (/*(NonBlank(INr.EUCodex) or (NonBlank(INr.BarCode) and len(INr.BarCode)==13) and IsStringNumeric(INr.BarCode))                   and*/ (ISr.Instock - tval)>=0) then begin                if (NonBlank(INr.EUCodex)) then begin                   identificator =  INr.EUCodex;                end else begin                  //identificator = INr.BarCode;                  identificator = INr.Code;                end;                colnum = 1;                  BeginRow(sheetnum,fileToSave,rownum,0,blankval);                  style = 4;                  StringCell(sheetnum,fileToSave,colnum,rownum,style,identificator,SharedStrings,numOfUniqueSharedStrings,numOfSharedStrings);                  style = 5;                  NumericCell(sheetnum,fileToSave,colnum,rownum,style,ISr.Instock - tval);                  style = 4;                  StringCell(sheetnum,fileToSave,colnum,rownum,style,"Set",SharedStrings,numOfUniqueSharedStrings,numOfSharedStrings);                  StringCell(sheetnum,fileToSave,colnum,rownum,style,"Samsung",SharedStrings,numOfUniqueSharedStrings,numOfSharedStrings);                EndRow(sheetnum,fileToSave,rownum);              end;            end else begin //Inventory Accessory-Samsung              if (INr.Group=="SMG_A") then begin                tval = qtyAccesSumsList[ISr.Code];                if ((ISr.Instock - tval)>=0) then begin                  if (NonBlank(INr.EUCodex)) then begin                     identificator = INr.EUCodex;                  end else begin                    /*if (NonBlank(INr.BarCode) and len(INr.BarCode)==13 and IsStringNumeric(INr.BarCode)) then begin                      identificator = INr.BarCode;                    end else begin*/                      identificator = INr.Code;                    //end;                  end;                  colnum = 1;                    BeginRow(sheetnum,fileToSave,rownum,0,blankval);                    style = 4;                    StringCell(sheetnum,fileToSave,colnum,rownum,style,identificator,SharedStrings,numOfUniqueSharedStrings,numOfSharedStrings);                    style = 5;                    NumericCell(sheetnum,fileToSave,colnum,rownum,style,ISr.Instock - tval);                    style = 4;                    StringCell(sheetnum,fileToSave,colnum,rownum,style,"Accessory",SharedStrings,numOfUniqueSharedStrings,numOfSharedStrings);                    StringCell(sheetnum,fileToSave,colnum,rownum,style,"Samsung",SharedStrings,numOfUniqueSharedStrings,numOfSharedStrings);                  EndRow(sheetnum,fileToSave,rownum);                end;              end else begin //Inventory Accessory-Others                tval = qtyAccesOthersList[ISr.Code];                if ((ISr.Instock - tval)>=0) then begin                  colnum = 1;                    BeginRow(sheetnum,fileToSave,rownum,0,blankval);                    style = 4;                    StringCell(sheetnum,fileToSave,colnum,rownum,style,ISr.Code,SharedStrings,numOfUniqueSharedStrings,numOfSharedStrings);                    style = 5;                    NumericCell(sheetnum,fileToSave,colnum,rownum,style,ISr.Instock - tval);                    style = 4;                    StringCell(sheetnum,fileToSave,colnum,rownum,style,"Accessory",SharedStrings,numOfUniqueSharedStrings,numOfSharedStrings);                    StringCell(sheetnum,fileToSave,colnum,rownum,style,"Others",SharedStrings,numOfUniqueSharedStrings,numOfSharedStrings);                  EndRow(sheetnum,fileToSave,rownum);                end;              end;            end;          end;         end;      end;           /* GetVectorTags(qtySetList,indexes); //Inventory Set-Samsung      for(i=0;i<indexes.length;i=i+1) begin        curindex = indexes[i];        pos = 0;        ExtractObjWithSeparator(";",curindex,false,pos,itemCode);        ExtractObjWithSeparator(";",curindex,false,pos,identificator);        ISr.Code = itemCode;        ISr.Location = locations;        if (ReadFirstMain(ISr,2,true) and (ISr.Instock - qtySetList[curindex])>=0) then begin          colnum = 1;            BeginRow(sheetnum,fileToSave,rownum,0,blankval);            style = 4;            StringCell(sheetnum,fileToSave,colnum,rownum,style,identificator,SharedStrings,numOfUniqueSharedStrings,numOfSharedStrings);            style = 5;            NumericCell(sheetnum,fileToSave,colnum,rownum,style,ISr.Instock - qtySetList[curindex]);            style = 4;            StringCell(sheetnum,fileToSave,colnum,rownum,style,"Set",SharedStrings,numOfUniqueSharedStrings,numOfSharedStrings);            StringCell(sheetnum,fileToSave,colnum,rownum,style,"Samsung",SharedStrings,numOfUniqueSharedStrings,numOfSharedStrings);          EndRow(sheetnum,fileToSave,rownum);        end;      end;      GetVectorTags(qtyAccesSumsList,indexes); //Inventory Accessory-Samsung      for(i=0;i<indexes.length;i=i+1) begin        curindex = indexes[i];        pos = 0;        ExtractObjWithSeparator(";",curindex,false,pos,itemCode);        ExtractObjWithSeparator(";",curindex,false,pos,identificator);        ISr.Code = itemCode;        ISr.Location = locations;        if (ReadFirstMain(ISr,2,true) and (ISr.Instock - qtyAccesSumsList[curindex])>=0) then begin          colnum = 1;            BeginRow(sheetnum,fileToSave,rownum,0,blankval);            style = 4;            StringCell(sheetnum,fileToSave,colnum,rownum,style,identificator,SharedStrings,numOfUniqueSharedStrings,numOfSharedStrings);            style = 5;            NumericCell(sheetnum,fileToSave,colnum,rownum,style,ISr.Instock - qtyAccesSumsList[curindex]);            style = 4;            StringCell(sheetnum,fileToSave,colnum,rownum,style,"Accessory",SharedStrings,numOfUniqueSharedStrings,numOfSharedStrings);            StringCell(sheetnum,fileToSave,colnum,rownum,style,"Samsung",SharedStrings,numOfUniqueSharedStrings,numOfSharedStrings);          EndRow(sheetnum,fileToSave,rownum);        end;      end;      GetVectorTags(qtyAccesOthersCodes,indexes); //Inventory Accessory-Others      for(i=0;i<indexes.length;i=i+1) begin        curindex = indexes[i];        pos = 0;        //ExtractObjWithSeparator(";"curindex,false,pos,itemCode);        //ExtractObjWithSeparator(";",curindex,false,pos,identificator);        ISr.Code = curindex;        ISr.Location = locations;        if (ReadFirstMain(ISr,2,true) and (ISr.Instock - qtyAccesOthersCodes[curindex])>=0) then begin          colnum = 1;            BeginRow(sheetnum,fileToSave,rownum,0,blankval);            style = 4;            StringCell(sheetnum,fileToSave,colnum,rownum,style,curindex,SharedStrings,numOfUniqueSharedStrings,numOfSharedStrings);            style = 5;            NumericCell(sheetnum,fileToSave,colnum,rownum,style,ISr.Instock - qtyAccesOthersCodes[curindex]);            style = 4;            StringCell(sheetnum,fileToSave,colnum,rownum,style,"Accessory",SharedStrings,numOfUniqueSharedStrings,numOfSharedStrings);            StringCell(sheetnum,fileToSave,colnum,rownum,style,"Others",SharedStrings,numOfUniqueSharedStrings,numOfSharedStrings);          EndRow(sheetnum,fileToSave,rownum);        end;      end;*/                      EndSheetData(sheetnum,fileToSave);    MergeCells(sheetnum,fileToSave,mergeCell,qtyMergeCell);    EndSheet(sheetnum,fileToSave,0);  FillSharedStrings(fileToSave,SharedStrings,numOfUniqueSharedStrings,numOfSharedStrings,mas);  ConvertToXLSX(fileToSave,false);  LSamsungSendFilesByMailEXCELMn:;    return;end;