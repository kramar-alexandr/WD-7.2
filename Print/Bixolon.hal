external procedure M4PadString(string,Integer,string,Boolean,var string);
external procedure ValToText(val,Integer,string,string,var string);
external function roundmode SetRoundModeD(Integer);
external updating function boolean EasySendTurboSMS(string, string);

SetLangMode(LangRussian,"RUS",0); 


procedure adresses(record SVOVc SVOr,var string Name, var string Address, var string Phone,var string eMail)
begin
  record CUVc CUr;
  

  Name = "";
  Address = "Київ, вул. Червоноармійська, 21";
  Phone = "Телефон (093)170-45-00";	
  
return;
end;

global updating procedure HandleWSReceiptPrinting(record WSVc WSr,var area aFile)		//Edit----------------------Dima  21.09.2015
begin
	string 10 SetLeftAlignment,SetRightAlignment,SetMiddleAlignment,SetTextSize;
	string 10 SetBoldOn,SetBoldOff,SetUnderlineOn,SetUnderlineOff;
	string 10 BigLetterOn,BigLetterOff,SmallLetterOn;
	string 100 s1,s2,s3, sTot,sVAT,sPay;
	string 200 Name,Address,Phone;
	integer rowLength;
	record SVOVc SVOr,SVO2r;
	
	SetLeftAlignment = chr(27) & chr(97) & "0";
	SetMiddleAlignment = chr(27) & chr(97) & "1";
	SetRightAlignment = chr(27) & chr(97) & "2";
	//SetTextSize = chr(29) & chr(33) & "1";
	SetBoldOn = chr(27) & chr(69) & "1";
	SetBoldOff = chr(27) & chr(69) & "0";
	SetUnderlineOn = chr(27) & chr(45) & "2";
	SetUnderlineOff = chr(27) & chr(45) & "0";
	BigLetterOn = chr(27) & chr(33)  & chr(32);
	SmallLetterOn = chr(27) & chr(33)  & chr(1);
	BigLetterOff = chr(27) & chr(33) & chr(0);
	
	rowLength = 32;
	
	SVOr.SerNr = WSr.SVONr;
	ReadFirstMain(SVOr,1,true);
	RecordCopy(SVO2r,SVOr);// Edit ************************** Wednesday, 28 October 2015 14:30:40
	SVOr.RegDate = currentDate;// Edit ************************** Wednesday, 28 October 2015 14:28:31
	RecordUpdate(SVO2r,SVOr,true);// Edit ************************** Wednesday, 28 October 2015 14:30:39
	
	switch (WSr.SalesGroup) begin
		case "3GR":
					Name = "СПД-ФО Іваненко В.І.";
					Address = "Україна, Київ, вул. Білоруська, 8";
					Phone = "Телефон \(044\) 222-57-74";	
		case "8GR":
					Name = "СПД-ФО Моісеєв Д. А.";
					Address = "Україна, Київ, просп. Московський, 6";
					Phone = "Телефон \(044\) 222-92-93";		
		case "9GR":
					Name = "СПД-ФО Головізнін С. Г.";
					Address = "Україна, Київ, вул. Червоноармійська,21";
					Phone = "Телефон \(044\) 451-5-451";			
		otherwise
					Name = "СПД-ФО Форманчук Д.В.";
					Address = "Україна, Київ, вул. Кіквідзе,3";
					Phone = "Телефон \(044\) 222-77-09";	
	end;	

	SetAreaZeroSize(aFile);

	
//Header	
	addtexttoarea(SetMiddleAlignment,aFile);
	addtexttoarea(Name & chr(13) & chr(10),aFile);
	addtexttoarea(SetLeftAlignment,aFile);	
	addtexttoarea(Address & chr(13) & chr(10),aFile);
	addtexttoarea(Phone & chr(13) & chr(10) ,aFile);
	addtexttoarea("________________________________" & chr(13) & chr(10) ,aFile);
	addtexttoarea(chr(13) & chr(10),aFile);	
	
//Body	
	addtexttoarea("Сервісне обслуговування" & chr(13) & chr(10) ,aFile);
	addtexttoarea(chr(13) & chr(10),aFile);
	addtexttoarea(SetRightAlignment,aFile);
	addtexttoarea("1.0 x " & WSr.Sum4 & " = " & WSr.Sum4 & chr(13) & chr(10),aFile);
	addtexttoarea("--------------------------------" & chr(13) & chr(10) ,aFile);	

	addtexttoarea(SetLeftAlignment,aFile);
	s1 = "Разом без ПДВ";
	s2 = "ПДВ";
	s3 = "Разом до сплати";	
	M4PadString(ValToString(WSr.Sum4,M4Val,"",".",0),rowLength - Len(s1)," ",true,sTot);
	sTot = s1 & sTot;
	M4PadString(ValToString(WSr.Sum3,M4Val,"",".",0),rowLength - Len(s2)," ",true,sVAT);
	sVAT = s2 & sVAT;
	M4PadString(ValToString(WSr.Sum4,M4Val,"",".",0),rowLength - Len(s3)," ",true,sPay);
	sPay = s3 & sPay;
	addtexttoarea(sTot & chr(13) & chr(10) ,aFile);
	addtexttoarea(sVAT & chr(13) & chr(10) ,aFile);
	addtexttoarea(SetBoldOn,aFile);
	addtexttoarea(sPay & chr(13) & chr(10) ,aFile);
	addtexttoarea(SetBoldOff,aFile);
	addtexttoarea("________________________________" & chr(13) & chr(10) ,aFile);
	
//Signature	
	addtexttoarea(chr(13) & chr(10),aFile);
	addtexttoarea(SetLeftAlignment,aFile);
	addtexttoarea(SmallLetterOn,aFile);
	addtexttoarea("Гарантія на виконання робіт становить:" & chr(13) & chr(10) ,aFile);
	addtexttoarea("-для iPhone,iPod,iPad - 1 рік" & chr(13) & chr(10) ,aFile);
	addtexttoarea("-для Мас і ноутбуків - 3 місяці" & chr(13) & chr(10) ,aFile);	
	addtexttoarea("-заміна пристрою - 3 місяці" & chr(13) & chr(10) ,aFile);
	addtexttoarea(chr(13) & chr(10),aFile);
/*	
	addtexttoarea("Замовник претензій по об'єму,якості та" & chr(13) & chr(10) ,aFile);
	addtexttoarea("строкам виконання робіт не має." & chr(13) & chr(10) ,aFile);
	addtexttoarea(chr(13) & chr(10),aFile);
	addtexttoarea(SetRightAlignment,aFile);	
	addtexttoarea("________________" & chr(13) & chr(10) ,aFile);
	addtexttoarea(SVOr.Vlastnik & chr(13) & chr(10) ,aFile);
*/
		
		
	addtexttoarea(SetLeftAlignment,aFile);
	addtexttoarea("Замовлення № " & WSr.SVONr & chr(13) & chr(10) ,aFile);
	addtexttoarea("Дата " & CurrentDate & chr(13) & chr(10) ,aFile);
	addtexttoarea("Час " & CurrentTime & chr(13) & chr(10) ,aFile);	
	addtexttoarea(chr(13) & chr(10),aFile);
	
	addtexttoarea(SetMiddleAlignment,aFile);
	addtexttoarea(BigLetterOn,aFile);
	addtexttoarea("НЕФІСКАЛЬНИЙ ЧЕК" & chr(13) & chr(10) ,aFile);
	addtexttoarea(BigLetterOff,aFile);			
	addtexttoarea(chr(13) & chr(10),aFile);
	addtexttoarea(chr(13) & chr(10),aFile);
	addtexttoarea(chr(13) & chr(10),aFile);
  addtexttoarea(chr(13) & chr(10),aFile);
	addtexttoarea(chr(13) & chr(10),aFile);
	addtexttoarea(chr(13) & chr(10),aFile);	

//Cut receipt  
  addtexttoarea(chr(29) & chr(86) & "1",aFile);
  
end;


global 
procedure HandleIVReceiptPrinting(record IVVc IVr,var area aFile)		//Edit----------------------Dima  21.09.2015
begin
	string 10 SetLeftAlignment,SetRightAlignment,SetMiddleAlignment,SetTextSize;
	string 10 SetBoldOn,SetBoldOff,SetUnderlineOn,SetUnderlineOff;
	string 10 BigLetterOn,BigLetterOff,SmallLetterOn;
	string 100 s1,s2,s3, sTot,sVAT,sPay;
	integer rowLength,i,rwcnt;
	row IVVc IVrw;
	string 200 Name,Address,Phone;
	
	SetLeftAlignment = chr(27) & chr(97) & "0";
	SetMiddleAlignment = chr(27) & chr(97) & "1";
	SetRightAlignment = chr(27) & chr(97) & "2";
	//SetTextSize = chr(29) & chr(33) & "1";
	SetBoldOn = chr(27) & chr(69) & "1";
	SetBoldOff = chr(27) & chr(69) & "0";
	SetUnderlineOn = chr(27) & chr(45) & "2";
	SetUnderlineOff = chr(27) & chr(45) & "0";
	BigLetterOn = chr(27) & chr(33)  & chr(32);
	SmallLetterOn = chr(27) & chr(33)  & chr(1);
	BigLetterOff = chr(27) & chr(33) & chr(0);
	
	rowLength = 32;

	
	switch (IVr.SalesGroup) begin
		case "3GR":
					Name = "СПД-ФО Іваненко В.І.";
					Address = "Україна, Київ, вул. Білоруська, 8";
					Phone = "Телефон \(044\) 222-57-74";	
		case "8GR":
					Name = "СПД-ФО Моісеєв Д. А.";
					Address = "Україна, Київ, просп. Московський, 6";
					Phone = "Телефон \(044\) 222-92-93";		
		case "9GR":
					Name = "СПД-ФО Головізнін С. Г.";
					Address = "Україна, Київ, вул. Червоноармійська,21";
					Phone = "Телефон \(044\) 451-5-451";			
		otherwise
					Name = "СПД-ФО Форманчук Д.В.";
					Address = "Україна, Київ, вул. Кіквідзе,3";
					Phone = "Телефон \(044\) 222-77-09";	
	end;		

	SetAreaZeroSize(aFile);

	
//Header	
	addtexttoarea(SetMiddleAlignment,aFile);
	addtexttoarea(Name & chr(13) & chr(10),aFile);
	addtexttoarea(SetLeftAlignment,aFile);	
	addtexttoarea(Address & chr(13) & chr(10),aFile);
	addtexttoarea(Phone & chr(13) & chr(10) ,aFile);
	addtexttoarea("________________________________" & chr(13) & chr(10) ,aFile);
	addtexttoarea(chr(13) & chr(10),aFile);	
	
//Body	
	rwcnt = MatRowCnt(IVr);
	for(i=0;i<rwcnt;i=i+1) begin
		MatRowGet(IVr,i,IVrw);		
		if (IVrw.stp==kInvoiceRowTypeNormal and nonblank(IVrw.ArtCode)) then begin
			addtexttoarea(SetLeftAlignment,aFile);
			addtexttoarea(IVrw.Spec & chr(13) & chr(10) ,aFile);
			addtexttoarea(IVrw.SerialNr & chr(13) & chr(10) ,aFile);
			addtexttoarea(SetRightAlignment,aFile);
			if (nonblank(IVrw.vRebate)) then begin
				addtexttoarea("Знижка " & IVrw.vRebate & "%" & chr(13) & chr(10),aFile);
			end;
			addtexttoarea(IVrw.Quant & " x " & IVrw.Price & " = " & IVrw.Sum & chr(13) & chr(10),aFile);
		end;
	end;	
	
	addtexttoarea("--------------------------------" & chr(13) & chr(10) ,aFile);
	addtexttoarea(SetLeftAlignment,aFile);
	s1 = "Разом без ПДВ";
	s2 = "ПДВ";
	s3 = "Разом до сплати";	
	M4PadString(ValToString(IVr.Sum4,M4Val,"",".",0),rowLength - Len(s1)," ",true,sTot);
	sTot = s1 & sTot;
	M4PadString(ValToString(IVr.Sum3,M4Val,"",".",0),rowLength - Len(s2)," ",true,sVAT);
	sVAT = s2 & sVAT;
	M4PadString(ValToString(IVr.Sum4,M4Val,"",".",0),rowLength - Len(s3)," ",true,sPay);
	sPay = s3 & sPay;
	addtexttoarea(sTot & chr(13) & chr(10) ,aFile);
	addtexttoarea(sVAT & chr(13) & chr(10) ,aFile);
	addtexttoarea(SetBoldOn,aFile);
	addtexttoarea(sPay & chr(13) & chr(10) ,aFile);
	addtexttoarea(SetBoldOff,aFile);
	

	
	
	addtexttoarea("________________________________" & chr(13) & chr(10) ,aFile);
	
//Signature	

	addtexttoarea("Чек № " & IVr.SerNr & chr(13) & chr(10) ,aFile);
	addtexttoarea("Дата " & CurrentDate & chr(13) & chr(10) ,aFile);
	addtexttoarea("Час " & CurrentTime & chr(13) & chr(10) ,aFile);	
	addtexttoarea(chr(13) & chr(10),aFile);
	
	addtexttoarea(SetMiddleAlignment,aFile);
	addtexttoarea(BigLetterOn,aFile);
	addtexttoarea("НЕФІСКАЛЬНИЙ ЧЕК" & chr(13) & chr(10) ,aFile);
	addtexttoarea(BigLetterOff,aFile);			
	addtexttoarea(chr(13) & chr(10),aFile);
	addtexttoarea(chr(13) & chr(10),aFile);
	addtexttoarea(chr(13) & chr(10),aFile);
	addtexttoarea(chr(13) & chr(10),aFile);
	addtexttoarea(chr(13) & chr(10),aFile);
	addtexttoarea(chr(13) & chr(10),aFile);

//Cut receipt  
  addtexttoarea(chr(29) & chr(86) & "1",aFile);
  
end;


global procedure getQRCode(string path, var area qrArea)
begin
  area req,nl;
  
  logtext(0,"getQRCode");
  
  addtexttoarea(currentdate & " " & currenttime & chr(13) & chr(10),nl);
  
  addtexttoarea("{",req);
  addtexttoarea("\"text\":",req);
  addtexttoarea("\"" & path & "\",",req);
  addtexttoarea("\"mW\":4,",req);
  addtexttoarea("\"mH\":4",req);
  addtexttoarea("}",req);
  
  writeareatofile(nl,"QRreq.txt",1);
  writeareatofile(req,"QRreq.txt",1);
  SendWebRequest("127.0.0.1",3006,-1,false,"POST","/qrcodegenerate","application/json","",false,req,qrArea,5);
  
  writeareatofile(nl,"QRres.txt",1);
  writeareatofile(qrArea,"QRres.txt",1);
  
  
return;
end;

global function string 200 CommisionCodeBlockComment(string code)
begin
  record CommisionCodeBlock CommisionCodeb;
  row CommisionCodeBlock CommisionCoderw;
  integer i;
  string 200 res;
  
  blockload(CommisionCodeb);
  for(i=0;i<matrowcnt(CommisionCodeb);i=i+1)begin
    matrowget(CommisionCodeb,i,CommisionCoderw);
    if(code==CommisionCoderw.Code)then begin
      res = CommisionCoderw.Comment;
    end;
  end;
  
  CommisionCodeBlockComment = res;
return;
end;


global function val CommisionCodeBlockComission(string code)
begin
  record CommisionCodeBlock CommisionCodeb;
  row CommisionCodeBlock CommisionCoderw;
  integer i;
  val res;
  
  blockload(CommisionCodeb);
  for(i=0;i<matrowcnt(CommisionCodeb);i=i+1)begin
    matrowget(CommisionCodeb,i,CommisionCoderw);
    if(code==CommisionCoderw.Code)then begin
      res = CommisionCoderw.Percent;
    end;
  end;
  
  CommisionCodeBlockComission = res;
return;
end;


global 
procedure HandleORReceiptPrinting(record ORVc ORr,var area aFile,string fop)		//Edit----------------------Dima  21.09.2015
begin
	string 10 SetLeftAlignment,SetRightAlignment,SetMiddleAlignment,SetTextSize,PrintImage;
	string 10 SetBoldOn,SetBoldOff,SetUnderlineOn,SetUnderlineOff;
	string 10 BigLetterOn,BigLetterOff,SmallLetterOn;
	string 100 s1,s2,s3, sTot,sVAT,sPay;
	integer rowLength,i,rwcnt;
	row ORVc ORrw;
	string 200 Name,Address,Phone,tstr,ID;
	record FOPDataBlock FOPb;
	row FOPDataBlock FOPrw;
	val comiss,nocomsum;
	record PayComisBlock PCb;
	string 255 addcomment,tax_url,FisName,FisAddress,FisID;
  date fdate;
  time ftime;
	area qrArea,tmpar;
	longint alen,ai,acnt,alast;
  vector string 255 vstr;
	
	
	blockload(PCb);
	blockload(FOPb);
	if(nonblank(fop))then begin
		for(i=0;i<matrowcnt(FOPb);i=i+1)begin
			matrowget(FOPb,i,FOPrw);
			if(FOPrw.Name==fop)then begin
			Name = FOPrw.Name;
			ID = FOPrw.ID;
			FisName = FOPrw.FisName;
			FisAddress = FOPrw.FisAddress;
			FisID = FOPrw.FisID;
			end;
		end;
	end;
	
	SetLeftAlignment = chr(27) & chr(97) & "0";
	SetMiddleAlignment = chr(27) & chr(97) & "1";
	SetRightAlignment = chr(27) & chr(97) & "2";
	//SetTextSize = chr(29) & chr(33) & "1";
	SetBoldOn = chr(27) & chr(69) & "1";
	SetBoldOff = chr(27) & chr(69) & "0";
	SetUnderlineOn = chr(27) & chr(45) & "2";
	SetUnderlineOff = chr(27) & chr(45) & "0";
	BigLetterOn = chr(27) & chr(33)  & chr(32);
	SmallLetterOn = chr(27) & chr(33)  & chr(1);
	BigLetterOff = chr(27) & chr(33) & chr(0);
	PrintImage = chr(28) & chr(112) & chr(1) & chr(0);
	
	rowLength = 32;
	
	SetAreaZeroSize(aFile);

//Header	
	//addtexttoarea(PrintImage,aFile);
	addtexttoarea(SetMiddleAlignment,aFile);
	addtexttoarea("www.istore.ua" & chr(13) & chr(10),aFile);
	addtexttoarea("0800 330 334" & chr(13) & chr(10),aFile);
	addtexttoarea(chr(13) & chr(10) ,aFile);
	addtexttoarea(SetLeftAlignment,aFile);	
	//addtexttoarea(SetBoldOn,aFile);
	//addtexttoarea("Товарний чек №" & ORr.SerNr & " від " & ORr.OrdDate & "." & chr(13) & chr(10) ,aFile);
	//addtexttoarea(SetBoldOff,aFile);
	
	if(nonblank(ORr.FiscalID))then begin //==================== ФУТЕР ФИСКАЛЬНОГО ЧЕКА
    addtexttoarea(SetBoldOff,aFile);
    addtexttoarea(FisName & chr(13) & chr(10) ,aFile);
    addtexttoarea(FisAddress & chr(13) & chr(10) ,aFile);
    addtexttoarea(FisID & chr(13) & chr(10) ,aFile);
    addtexttoarea(chr(13) & chr(10) ,aFile);
  end else begin
    addtexttoarea(SetBoldOn,aFile);
    addtexttoarea("Постачальник" & chr(13) & chr(10) ,aFile);
    addtexttoarea(SetBoldOff,aFile);
    addtexttoarea(Name & chr(13) & chr(10) ,aFile);
    addtexttoarea(ID & chr(13) & chr(10) ,aFile);
    addtexttoarea(chr(13) & chr(10) ,aFile);
	end;
	
	addtexttoarea(SetBoldOn,aFile);
	addtexttoarea("Клiєнт" & chr(13) & chr(10) ,aFile);
	addtexttoarea(SetBoldOff,aFile);
	addtexttoarea(ORr.Addr0 & chr(13) & chr(10) ,aFile);
	addtexttoarea(ORr.Phone & chr(13) & chr(10) ,aFile);
	addtexttoarea(chr(13) & chr(10) ,aFile);
	
	if(currentcompany!=13)then begin
		if(nonblank(ORr.Addr1) or nonblank(ORr.Addr2) or nonblank(ORr.Addr3))then begin
			addtexttoarea(SetBoldOn,aFile);
			addtexttoarea("Адреса доставки" & chr(13) & chr(10) ,aFile);
			addtexttoarea(SetBoldOff,aFile);
			if(nonblank(ORr.Addr1))then begin
				addtexttoarea(ORr.Addr1 & chr(13) & chr(10) ,aFile);
			end;
			if(nonblank(ORr.Addr2))then begin
				addtexttoarea(ORr.Addr2 & chr(13) & chr(10) ,aFile);
			end;
			if(nonblank(ORr.Addr3))then begin
				addtexttoarea(ORr.Addr3 & chr(13) & chr(10) ,aFile);
			end;
			addtexttoarea(chr(13) & chr(10) ,aFile);
		end;
	end else begin
		if(nonblank(ORr.ShipAddr1) or nonblank(ORr.Addr2) or nonblank(ORr.Addr3))then begin
			addtexttoarea(SetBoldOn,aFile);
			addtexttoarea("Адреса доставки" & chr(13) & chr(10) ,aFile);
			addtexttoarea(SetBoldOff,aFile);
			if(nonblank(ORr.ShipAddr1))then begin
				addtexttoarea(ORr.ShipAddr1 & chr(13) & chr(10) ,aFile);
			end;
			if(nonblank(ORr.ShipAddr2))then begin
				addtexttoarea(ORr.ShipAddr2 & chr(13) & chr(10) ,aFile);
			end;
			if(nonblank(ORr.ShipAddr3))then begin
				addtexttoarea(ORr.Addr3 & chr(13) & chr(10) ,aFile);
			end;
			addtexttoarea(chr(13) & chr(10) ,aFile);
		end;
	end;
	
	if(nonblank(ORr.Comment))then begin
		addtexttoarea(SetBoldOn,aFile);
		addtexttoarea("Коментар до замовлення" & chr(13) & chr(10) ,aFile);
		addtexttoarea(SetBoldOff,aFile);
		addtexttoarea(ORr.Comment & chr(13) & chr(10) ,aFile);
		addtexttoarea(chr(13) & chr(10) ,aFile);
	end;
	addtexttoarea("________________________________" & chr(13) & chr(10) ,aFile);
	addtexttoarea(chr(13) & chr(10),aFile);	
	
//Body	
	rwcnt = MatRowCnt(ORr);
	for(i=0;i<rwcnt;i=i+1) begin
		MatRowGet(ORr,i,ORrw);
		if(ORrw.ArtCode=="COM")then begin
			comiss = ORrw.Price;
		end;
		if(ORrw.stp==kInvoiceRowTypeNormal and nonblank(ORrw.ArtCode) and ORrw.ArtCode!="COM")then begin
			nocomsum = nocomsum + ORrw.Sum;
		end;
	end;
	
	if(comiss>0)then begin
		ORr.Sum4 = 0;
		for(i=0;i<rwcnt;i=i+1) begin
			MatRowGet(ORr,i,ORrw);
			if(ORrw.stp==kInvoiceRowTypeNormal and nonblank(ORrw.ArtCode) and ORrw.ArtCode!="COM")then begin
				ORrw.Sum = ORrw.Sum + round(ORrw.Sum/nocomsum*comiss,SetRoundModeD(2));
				if(ORrw.vRebate==0)then begin
					if(ORrw.Quant!=1)then begin
						ORrw.Price = round(ORrw.Sum/ORrw.Quant,SetRoundModeD(2));
					end else begin
						ORrw.Price = ORrw.Sum;
					end;
				end else begin
					ORrw.Price = round(ORrw.Sum/ORrw.Quant/((100-ORrw.vRebate)/100),SetRoundModeD(2));
				end;
				ORr.Sum4 = ORr.Sum4 + ORrw.Sum;
				MatRowPut(ORr,i,ORrw);
			end;
		end;
	end;
	
	for(i=0;i<rwcnt;i=i+1) begin
		MatRowGet(ORr,i,ORrw);		
		if (ORrw.stp==kInvoiceRowTypeNormal and nonblank(ORrw.ArtCode) and ORrw.ArtCode!="COM") then begin
			addtexttoarea(SetLeftAlignment,aFile);
			addtexttoarea(ORrw.Spec & chr(13) & chr(10) ,aFile);
			addtexttoarea(ORrw.SerialNr & chr(13) & chr(10) ,aFile);
			addtexttoarea(SetRightAlignment,aFile);
			if (nonblank(ORrw.vRebate)) then begin
				addtexttoarea("Знижка " & ORrw.vRebate & "%" & chr(13) & chr(10),aFile);
			end;
			addtexttoarea(ORrw.Quant & " x " & ORrw.Price & " = " & ORrw.Sum & chr(13) & chr(10),aFile);
		end;
	end;	
	
	addtexttoarea("--------------------------------" & chr(13) & chr(10) ,aFile);
	addtexttoarea(SetLeftAlignment,aFile);
	//s1 = "Разом без ПДВ";
	//s2 = "ПДВ";
	s3 = "Разом до сплати";	
	//M4PadString(ValToString(ORr.Sum4,M4Val,"",".",0),rowLength - Len(s1)," ",true,sTot);
	//sTot = s1 & sTot;
	//M4PadString(ValToString(ORr.Sum3,M4Val,"",".",0),rowLength - Len(s2)," ",true,sVAT);
	//sVAT = s2 & sVAT;
	M4PadString(ValToString(ORr.Sum4,M4Val,"",".",0),rowLength - Len(s3)," ",true,sPay);
	sPay = s3 & sPay;
	//addtexttoarea(sTot & chr(13) & chr(10) ,aFile);
	//addtexttoarea(sVAT & chr(13) & chr(10) ,aFile);
	addtexttoarea(SetBoldOn,aFile);
	addtexttoarea(sPay & chr(13) & chr(10) ,aFile);
	addtexttoarea(SetBoldOff,aFile);
	addtexttoarea(SetBoldOn,aFile);
	addtexttoarea("Сума прописом:" & chr(13) & chr(10) ,aFile);
	addtexttoarea(SetBoldOff,aFile);
	tstr = "";
	ValToText(ORr.Sum4,M4Val,"UAH","UKR",tstr);
	addtexttoarea(tstr & chr(13) & chr(10) ,aFile);
	
	if(ORr.PayVal01!=0 or ORr.PayVal02!=0 or ORr.PayVal03!=0 or ORr.PayVal04!=0 or ORr.PayVal05!=0 or ORr.PayVal06!=0 or ORr.PayVal07!=0 or ORr.PayValWithCom!=0)then begin
	addtexttoarea("___________ Оплата _____________" & chr(13) & chr(10) ,aFile);
		if(ORr.PayVal01!=0)then begin
			sPay = "";
			s3 = "Готівка";	
			M4PadString(ValToString(ORr.PayVal01 + round(ORr.PayVal01/100*PCb.PayVal01,SetRoundModeD(2)),M4Val,"",".",0),rowLength - Len(s3)," ",true,sPay);
			sPay = s3 & sPay;
			addtexttoarea(sPay & chr(13) & chr(10) ,aFile);
		end;
		if(ORr.PayVal02!=0)then begin
			sPay = "";
			s3 = "Термінал";	
			M4PadString(ValToString(ORr.PayVal02 + round(ORr.PayVal02/100*PCb.PayVal02,SetRoundModeD(2)),M4Val,"",".",0),rowLength - Len(s3)," ",true,sPay);
			sPay = s3 & sPay;
			addtexttoarea(sPay & chr(13) & chr(10) ,aFile);
		end;
		if(ORr.PayVal03!=0)then begin
			sPay = "";
			s3 = "Б/Н без ПДВ";	
			M4PadString(ValToString(ORr.PayVal03 + round(ORr.PayVal03/100*PCb.PayVal03,SetRoundModeD(2)),M4Val,"",".",0),rowLength - Len(s3)," ",true,sPay);
			sPay = s3 & sPay;
			addtexttoarea(sPay & chr(13) & chr(10) ,aFile);
		end;
		if(ORr.PayVal04!=0)then begin
			sPay = "";
			s3 = "Кредит";	
			M4PadString(ValToString(ORr.PayVal04 + round(ORr.PayVal04/100*PCb.PayVal04,SetRoundModeD(2)),M4Val,"",".",0),rowLength - Len(s3)," ",true,sPay);
			sPay = s3 & sPay;
			addtexttoarea(sPay & chr(13) & chr(10) ,aFile);
		end;
		if(ORr.PayVal05!=0)then begin
			sPay = "";
			s3 = "iBan";	
			M4PadString(ValToString(ORr.PayVal05 + round(ORr.PayVal05/100*PCb.PayVal05,SetRoundModeD(2)),M4Val,"",".",0),rowLength - Len(s3)," ",true,sPay);
			sPay = s3 & sPay;
			addtexttoarea(sPay & chr(13) & chr(10) ,aFile);
		end;
		if(ORr.PayVal06!=0)then begin
			sPay = "";
			s3 = "Термінал 2";	
			M4PadString(ValToString(ORr.PayVal06 + round(ORr.PayVal06/100*PCb.PayVal06,SetRoundModeD(2)),M4Val,"",".",0),rowLength - Len(s3)," ",true,sPay);
			sPay = s3 & sPay;
			addtexttoarea(sPay & chr(13) & chr(10) ,aFile);
		end;
		if(ORr.PayVal07!=0)then begin
			sPay = "";
			s3 = "Переказ";	
			M4PadString(ValToString(ORr.PayVal07 + round(ORr.PayVal07/100*PCb.PayVal07,SetRoundModeD(2)),M4Val,"",".",0),rowLength - Len(s3)," ",true,sPay);
			sPay = s3 & sPay;
			addtexttoarea(sPay & chr(13) & chr(10) ,aFile);
		end;
		if(ORr.PayValWithCom!=0)then begin
			sPay = "";
			s3 = CommisionCodeBlockComment(ORr.ComisionCode);	
			M4PadString(ValToString(ORr.PayValWithCom + round(ORr.PayValWithCom/100*CommisionCodeBlockComission(ORr.ComisionCode),SetRoundModeD(2)),M4Val,"",".",0),rowLength - Len(s3)," ",true,sPay);
			sPay = s3 & sPay;
			addtexttoarea(sPay & chr(13) & chr(10) ,aFile);
		end;
		
	end;
		
	addtexttoarea("________________________________" & chr(13) & chr(10) ,aFile);
//Signature	
	addtexttoarea("Товарний чек № " & ORr.SerNr & chr(13) & chr(10) ,aFile);
	addtexttoarea("Дата " & CurrentDate & chr(13) & chr(10) ,aFile);
	addtexttoarea("Час " & CurrentTime & chr(13) & chr(10) ,aFile);	
	
	addtexttoarea(chr(13) & chr(10),aFile);
	addtexttoarea(chr(13) & chr(10),aFile);

	addtexttoarea(SetMiddleAlignment,aFile);
	//addtexttoarea("info@istore.solutions" & chr(13) & chr(10) ,aFile);
	addtexttoarea(BigLetterOn,aFile);
	addtexttoarea("Дякуємо," & chr(13) & chr(10) ,aFile);
	addtexttoarea("що обрали нас!" & chr(13) & chr(10) ,aFile);
	addtexttoarea(BigLetterOff,aFile);	
	
	
	if(nonblank(ORr.FiscalID))then begin //==================== ФУТЕР ФИСКАЛЬНОГО ЧЕКА
    
    tstr = "Чек №" & " " & ORr.FiscalCode; //ФИскальнй номер чека
		addtexttoarea(tstr & chr(10),aFile); tstr ="";
		
		fdate.day = stringtoint(mid(ORr.FiscalDate,8,2));
		fdate.month = stringtoint(mid(ORr.FiscalDate,5,2));
		fdate.year = stringtoint(left(ORr.FiscalDate,4));
		
		ftime = stringtotime(mid(ORr.FiscalDate,11,8));
		ftime = addhours(ftime,2);
    tstr = fdate & " об " & ftime; ////ФИскальнй дата
		addtexttoarea(tstr & chr(10),aFile); tstr ="";
		
		tstr = "ФН: " & ORr.FiscalNum; ////ФИскальнй номер кассы
		addtexttoarea(tstr & chr(10),aFile); tstr ="";
    
    tax_url = ORr.tax_url;
    
    getQRCode(tax_url,qrArea);
    alast = 0;
    if(getarealength(qrArea)>100)then begin
      alen = CountLinesInArea(qrArea);
      for(ai=0;ai<alen;ai=ai+1)begin
        vstr[""] = convertstringfromcodepage("WINDOWS-1251",GetLineFromArea(qrArea,ai));
        //OutComPort(1,vstr[""]);
        addtexttoarea(vstr[""],aFile);
        addtexttoarea(vstr[""],tmpar);
      end;
    end;
    addtexttoarea(chr(10),aFile);
    writeareatofile(tmpar,"tmpar.txt",0);
    writeareatofile(aFile,"aFile.txt",0);
    //filetocomport(1,"tmpar.txt");
    tstr ="";
    
    if(left(ORr.FiscalNum,4)=="TEST")then begin
      tstr = "НЕ ФIСКАЛЬНИЙ ЧЕК"; ////ФИскальнй номер кассы
      addtexttoarea(tstr & chr(10),aFile); tstr ="";
      addtexttoarea(chr(13) & chr(10),aFile);
      addtexttoarea(chr(13) & chr(10),aFile);
      addtexttoarea(chr(13) & chr(10),aFile);
      addtexttoarea(chr(13) & chr(10),aFile);
    end else begin
      tstr = "ФIСКАЛЬНИЙ ЧЕК"; ////ФИскальнй номер кассы
      addtexttoarea(tstr & chr(10),aFile); tstr ="";
      addtexttoarea(chr(13) & chr(10),aFile);
      addtexttoarea(chr(13) & chr(10),aFile);
      addtexttoarea(chr(13) & chr(10),aFile);
      addtexttoarea(chr(13) & chr(10),aFile);
      addtexttoarea(chr(13) & chr(10),aFile);
    end;
    
    
  end else begin
    addtexttoarea(chr(13) & chr(10),aFile);
    addtexttoarea("НЕФІСКАЛЬНИЙ ЧЕК" & chr(13) & chr(10) ,aFile);
    addtexttoarea(chr(13) & chr(10),aFile);
    addtexttoarea(chr(13) & chr(10),aFile);
    addtexttoarea(chr(13) & chr(10),aFile);
    addtexttoarea(chr(13) & chr(10),aFile);
    addtexttoarea(chr(13) & chr(10),aFile);
  end;
	
//Cut receipt  
  addtexttoarea(chr(29) & chr(86) & "1",aFile);
  
end;

//Edit **********************************************Vas-P	10/11/2021
procedure TLTOARR(integer length,string text,var area atext)
begin
  string 255 res;
  
  if(length==0)then begin
    res = text;
    addtexttoarea(text,atext);
    addtexttoarea(chr(13) & chr(10),atext);
  end else begin
    res = text;
LTLTOARR:;
    if(len(res)>length)then begin
      addtexttoarea(left(res,length),atext);
      addtexttoarea(chr(13) & chr(10),atext);
      res = right(res,len(res)-length);
      goto LTLTOARR;
    end else begin
      addtexttoarea(res,atext);
      addtexttoarea(chr(13) & chr(10),atext);
    end;
  end;
  
return;
end;

procedure TLTOARRVECTOR(integer length,vector string text,var area atext)
begin
  string 255 res,c;
  integer newlength,i;
  
  
  if(length==0)then begin
    res = text[""];
    addtexttoarea(text[""],atext);
    addtexttoarea(chr(13) & chr(10),atext);
  end else begin
    res = text[""];
lTLTOARRVECTOR:;
    if(len(res)>length)then begin
      newlength = length;
      for(i=0;i<length;i=i+1)begin
        c = mid(res,i,1);
        if(c==" ")then begin
          newlength = i;
        end;
      end;
      if(newlength==0)then begin
        newlength = length;
      end;
      addtexttoarea(left(res,newlength),atext);
      addtexttoarea(chr(13) & chr(10),atext);
      res = trim(right(res,len(res)-newlength));
      goto lTLTOARRVECTOR;
    end else begin
      addtexttoarea(res,atext);
      addtexttoarea(chr(13) & chr(10),atext);
    end;
  end;
  
return;
end;


//Edit **********************************************Vas-P	added 10/11/2021
global 
updating procedure HandleBixolonWarranty(record ORVc ORr,var area aFile,boolean bixolonnewimg,vector boolean excludeitems)
begin
	string 10 SetLeftAlignment,SetRightAlignment,SetMiddleAlignment,SetTextSize,PrintImage;
	string 10 SetBoldOn,SetBoldOff,SetUnderlineOn,SetUnderlineOff;
	string 10 BigLetterOn,BigLetterOff,SmallLetterOn;
	string 100 SetFontA,SetFontB;
	string 10 rebate;
	val sumreb;
	integer checklength,rwcnt,i;
	row ORVc ORrw;
	integer k;
	vector string 255 text;
	string 255 tax_url;
	area qrArea;
	longint alen,ai;
	date selldate;
	record IVVc IVr;
	record SHVc SHr;
	
	
	checklength = 56;
	
	SetFontA = chr(27) & chr(33) & chr(0);
	SetFontB = chr(27) & chr(33) & chr(1);
	SetLeftAlignment = chr(27) & chr(97) & "0";
	SetMiddleAlignment = chr(27) & chr(97) & "1";
	SetRightAlignment = chr(27) & chr(97) & "2";
	SetBoldOn = chr(27) & chr(69) & "1";
	SetBoldOff = chr(27) & chr(69) & "0";
	SetUnderlineOn = chr(27) & chr(45) & "2";
	SetUnderlineOff = chr(27) & chr(45) & "0";
	BigLetterOn = chr(27) & chr(33)  & chr(32);
	SmallLetterOn = chr(27) & chr(33)  & chr(1);
	BigLetterOff = chr(27) & chr(33) & chr(0);
	PrintImage = chr(28) & chr(112) & chr(1) & chr(0);
	
	
	///1d 28 4c 06 00 30 45 30 30 01 01 0a
	if(bixolonnewimg)then begin
	  PrintImage = chr(29) & chr(40) & chr(76) & chr(6) &  chr(0) & chr(48) & chr(69) & chr(48) & chr(48) & chr(1) & chr(1);
	end;
	
	//SetAreaZeroSize(aFile);
	  
	  selldate = ORr.OrdDate;
    IVr.OrderNr = ORr.SerNr;
    if(readfirstkey("OrderNr",IVr,1,true))then begin
      selldate = IVr.InvDate;
    end;
    SHr.OrderNr = ORr.SerNr;
    if (ReadLastKey("OrderKey",SHr,1,true)) then begin
      selldate = SHr.ShipDate;
    end;
	
		addtexttoarea(PrintImage,aFile);
		
		addtexttoarea(SetFontB,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		addtexttoarea(SetMiddleAlignment,aFile);
		addtexttoarea(SetBoldOn,aFile);
		TLTOARR(checklength,"ГАРАНТІЙНИЙ ТАЛОН ВІД ВИРОБНИКА",aFile);
		TLTOARR(checklength,"Обмежена річна гарантія Apple",aFile);
		addtexttoarea(SetBoldOff,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		addtexttoarea(SetLeftAlignment,aFile);
		TLTOARR(checklength,"========================================================",aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		rwcnt = MatRowCnt(ORr);
	  for(i=0;i<rwcnt;i=i+1) begin
      MatRowGet(ORr,i,ORrw);
      if(ORrw.stp==kInvoiceRowTypeNormal)then begin
        if(ORrw.GarantyFor>0 and excludeitems[ORrw.ArtCode & ":" & ORrw.SerialNr]==false)then begin
        
          addtexttoarea(SetUnderlineOff,aFile);
          TLTOARR(checklength,"НАЗВА ТОВАРУ:",aFile);
          addtexttoarea(SetUnderlineOn,aFile);
          TLTOARR(checklength,ORrw.Spec,aFile);
        
          addtexttoarea(SetUnderlineOff,aFile);
          TLTOARR(checklength,"СЕРІЙНИЙ НОМЕР: " & ORrw.SerialNr,aFile);
        
          TLTOARR(checklength,"ДАТА ПРОДАЖУ: " & selldate,aFile);
          addtexttoarea(SetBoldOn,aFile);
          TLTOARR(checklength,"ДАТА ЗАКІНЧЕННЯ ГАРАНТІЙНОГО ТЕРМІНУ: " & addmonth(selldate,ORrw.GarantyFor),aFile);
          TLTOARR(checklength,"ТЕРМІН ГАРАНТІЇ (МІСЯЦІВ): " & ORrw.GarantyFor,aFile);
          addtexttoarea(SetBoldOff,aFile);
          addtexttoarea(chr(13) & chr(10),aFile);
        end;
      end;
		end;
		
		addtexttoarea(SetBoldOff,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		TLTOARR(checklength,"========================================================",aFile);
		
		TLTOARR(checklength,"Шановний клієнте!",aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "Гарантійний термін експлуатації виробу дорівнює гарантійному строку. Строк гарантії відраховується з дати роздрібного продажу споживачеві.";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "У разі виявлення несправностей, для здійснення діагностики та ремонту, просимо Вас звертатися в сервісний центр:";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		text[""] = "Сервісний центр А-сервіс: ";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "        Адреса: Київ, вул.Бойчука 1/2";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "        Телефон: +380 (93) 170 45 00";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "        Веб-сайт:";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "        www.a-service.ua";
		TLTOARRVECTOR(checklength,text,aFile);
		
		
		addtexttoarea(chr(13) & chr(10),aFile);
		text[""] = "ОБМІН ТА ПОВЕРНЕННЯ ТОВАРУ";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
    TLTOARR(checklength,"Споживач перед придбанням товару перевіряє його комплектацію, відсутність пошкоджень або дефектів.",aFile);
		TLTOARR(checklength,"Обмін або повернення товару належної якості здійснюється протягом 14 днів.",aFile);
		text[""] = "Будь ласка, зверніть увагу, обміну або поверненню підлягає тільки новий товар, який не активований, який не був в експлуатації і";
		text[""] = text[""] & " не має слідів використання. Обов’язково повинно бути збережено: повний комплект товару, цілісність, неушкодженість та";
		text[""] = text[""] & " всі частини упаковки, ярлики, захисні плівки, заводське маркування.";
		TLTOARRVECTOR(checklength,text,aFile);
		 
		addtexttoarea(chr(13) & chr(10),aFile);
		text[""] = "Гарантія Lite";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = " - Гарантія iStore 30 днів - це турбота про Ваш iPhone, iPad, Macbook та Apple Watch.";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = " - Гарантійне обслуговування. У разі виявлення заводського дефекту, ми зробимо заміну пристрою на новий.";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = " - Після закінченя 30 днів, ремонтом пристрою займається Авторизований Сервісний центр згідно правилам компанії Apple";
		TLTOARRVECTOR(checklength,text,aFile);
		
		addtexttoarea(chr(13) & chr(10),aFile);
		text[""] = "ГАРАНТІЯ APPLE";
		TLTOARRVECTOR(checklength,text,aFile);
		
		text[""] = " Обмежена річна гарантія Apple є добровільною гарантією виробника. Вона надає права незалежно від прав, гарантованих законом про захист прав споживачів, зокрема щодо неякісних товарів.";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "Таким чином, умови обмеженої річної гарантії Apple надаються додатково до прав, установлених законом про захист прав споживачів, а не замість таких прав.";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = " Споживачі можуть вибирати, яким чином скористатися своїми правами: на основі обмеженої річної гарантії Apple або як передбачено законом про захист прав споживачів.";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "Важливо! Умови та положення обмеженої річної гарантії Apple не застосовуються до претензій, заявлених на підставі закону про захист прав споживачів.";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = " Додаткові відомості, що стосуються закону про захист прав споживачів, можна отримати на вебсайті Apple (www.apple.com/legal/warranty/statutoryrights.html) або в місцевій організації із захисту прав споживачів.";
		TLTOARRVECTOR(checklength,text,aFile);
		 
		addtexttoarea(chr(13) & chr(10),aFile);
		text[""] = "НА ЩО ПОШИРЮЄТЬСЯ ЦЯ ГАРАНТІЯ";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "Компанія Apple Distribution International Ltd, офіс якої розташовано за адресою Hollyhill Industrial Estate Hollyhill,";
		text[""] = text[""] & " Cork, Republic of Ireland (Республіка Ірландія), або її правонаступник (далі — Apple) надає гарантію, що поширюється на дефекти";
		text[""] = text[""] & " матеріалів і виготовлення в апаратному забезпеченні й аксесуарах Apple, які входили до комплекту постачання (далі — Продукт Apple)";
		text[""] = text[""] & " і використовувалися відповідно до посібників користувача Apple, технічних характеристик та інших опублікованих інструкцій щодо";
		text[""] = text[""] & " Продукту Apple. Гарантія діє протягом ОДНОГО (1) РОКУ з дати роздрібної покупки кінцевим користувачем (далі — Гарантійний період).";
		text[""] = text[""] & " Компенсацію за обмеженою річною гарантією для продукту Apple можна отримати в місцевих центрах обслуговування Apple у більшості";
		text[""] = text[""] & " країн світу (див. розділ «Порядок надання гарантійного обслуговування»). Якщо виявлено дефекти матеріалів або виготовлення,";
		text[""] = text[""] & " ви можете подати заявку на гарантійне обслуговування до компанії Apple, навіть якщо Продукт Apple було придбано в стороннього продавця.";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "Інформацію про особу, яка прийняла на себе зобов’язання щодо продукту Apple, придбаного в Королівстві Саудівська Аравія,";
		text[""] = text[""] & " Об’єднаних Арабських Еміратах чи Україні, див. На сторінці:";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "https://www.apple.com/legal/warranty/obligor.html";
		TLTOARRVECTOR(checklength,text,aFile);
		
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "Примітка. Усі претензії за обмеженою річною гарантією Apple розглядаються на умовах, визначених у цьому гарантійному документі.";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "Крім того, компанія Apple пропонує технічну підтримку телефоном протягом дев’яноста (90) днів із дати отримання продукту Apple.";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "(www.apple.com/legal/warranty/products/emea-vad-universal-warranty-ukranian.html)";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		TLTOARR(checklength,"========================================================",aFile);

		addtexttoarea(SetBoldOn,aFile);
		addtexttoarea(SetUnderlineOff,aFile);
		TLTOARR(checklength,"Ця гарантія не розповсюджується:",aFile);
		addtexttoarea(SetBoldOff,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "1.На косметичні пошкодження, включаючи, окрім іншого, подряпини, вм’ятини, та зламані пластикові деталі портів.";
		TLTOARRVECTOR(checklength,text,aFile);		
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "2.На пошкодження, викликані використанням виробів інших фірм.";
		TLTOARRVECTOR(checklength,text,aFile);
		
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "3.На недоліки, що були спричинені внаслідок недбалого поводження (включно, без обмеження, пошкодження, що заподіяні гострими предметами, вигинанням, стисканням, падінням, контактом з рідиною, вогнем";
		text[""] = text[""] & " тощо), чи спричинені неправильним використанням виробу, включаючи використання всупереч інструкціям, що супроводжують виріб.";

		TLTOARRVECTOR(checklength,text,aFile);
		
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "4.На пошкодження, спричинені землетрусами, нещасними випадками, дією непереборних сил, впливом на виріб магнітного чи іншого шкідливого випромінювання, потраплянням";
    text[""] = text[""] & " всередину виробу сторонніх предметів, у тому числі комах, збоями в роботі або невідповідністю стандартам мереж електроживлення, навмисними або необережними діями з вашого боку, або з боку третіх осіб.";
    TLTOARRVECTOR(checklength,text,aFile);
    		
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "5.Якщо виріб було відкрито, модифіковано або відремонтовано особою,  що не є представником уповноваженого сервісного центру, якщо цей виріб відремонтовано з";
		text[""] = text[""] & "використанням несанкціонованих запасних частин, коли серійний номер виробу було видалено, витерто, затерто, змінено, чи він є нерозбірливим, або у разі, якщо пошкодження виникли внаслідок обслуговування(включаючи оновлення та розширення).";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "6.На пошкодження, спричинені внаслідок використання виробу не у відповідності з опублікованими рекомендаціями компанії виробника.";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "7.Якщо виріб піддавався впливу зовнішніх факторів (наприклад корозії, окислюванню та ін.) або перебував поза дозволеного виробником діапазону температури, вологості та ін., який вказано в технічних";
		text[""] = text[""] & " специфікаціях, або на нього проливалася їжа або рідина, чи мали вплив хімічні речовини.";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "8.На дефекти, які виникли у зв’язку з нормальним зносом або нормальним старінням виробу.";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "9.На збережену інформацію та налаштування користувача (фотографії, музика, пошта, контакти та ін.)";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "ДІЇ КОМПАНІЇ APPLE У РАЗІ ОТРИМАННЯ ГАРАНТІЙНОЇ ПРЕТЕНЗІЇ";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "Якщо протягом Гарантійного періоду ви звертаєтеся до компанії Apple на підставі цієї гарантії, компанія Apple на власний розсуд:";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "(i) відремонтує Продукт Apple, застосувавши нові або раніше використовувані деталі Apple, які були перевірені та відповідають функціональним вимогам Apple; або";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);

    text[""] = "(ii) замінить Продукт Apple таким самим продуктом (або, за вашою згодою, таким, що має аналогічні чи в цілому подібні характеристики, що й оригінальний продукт,";
    text[""] = text[""] & "наприклад іншою моделлю з тими самими функціями або тією самою моделлю іншого кольору), який є новим або складається з нових і/або раніше використовуваних оригінальних деталей Apple,";
    text[""] = text[""] & "що були перевірені та відповідають функціональним вимогам Apple; або";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);

    text[""] = "(iii) поверне вам витрачені кошти в обмін на дефектний Продукт Apple.";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "Зверніть увагу, що замінний продукт або замінні деталі переходять у вашу власність. А несправний продукт, повернений до компанії Apple, або його несправні деталі, стають її власністю.";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);

    addtexttoarea(SetMiddleAlignment,aFile);
    tax_url = "https://www.apple.com/legal/warranty/products/emea-vad-universal-warranty-ukranian.html";
    getQRCode(tax_url,qrArea);
    if(getarealength(qrArea)>100)then begin
      alen = CountLinesInArea(qrArea);
      for(ai=0;ai<alen;ai=ai+1)begin
        text[""] = convertstringfromcodepage("WINDOWS-1251",GetLineFromArea(qrArea,ai));
        addtexttoarea(text[""],aFile);
      end;
    end;
		addtexttoarea(SetLeftAlignment,aFile);
		//TLTOARR(checklength,"9.На збережену інформацію та налаштування",aFile);
		//TLTOARR(checklength,"користувача (фотографії, музика, пошта,",aFile);
		//TLTOARR(checklength,"контакти та ін.)",aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		/*
		
		text[""] = "У разі придбання додаткових пакетів:" & SetBoldOn & " Захист дисплею і корпусу" & SetBoldOff;
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		text[""] = "Послуги які входять до пакету :";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		text[""] = "1. Одноразова безкоштовна заміна дисплею або скла.";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "2. Одноразова безкоштовна заміна скла задньої панелі.";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "3. Безкоштовна заміна акумулятора, якщо його ємність менше 79%";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		text[""] = "Правила обслуговування:";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		text[""] = "1. Срок виконання ремонту від 3 до 7 робочих днів.";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "2. Компанія iStore на власний розсуд замінить екран або скло.";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "3. Захист корпусу передбачає лише заміну заднього скла.";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "4. Заміну батареї виконується лише якщо ємність батареї стала нижчою за 79%";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "5. При виконанні ремонту можуть використовуватись як оригінальні запчастини, так і аналоги.";
		TLTOARRVECTOR(checklength,text,aFile);*/
		
		addtexttoarea(SetBoldOn,aFile);
		addtexttoarea(SetUnderlineOn,aFile);
		text[""] = "Товар отримав у цілому стані та повній комплектації";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "3 умовами гарантії ознайомлений і згоден";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(SetBoldOff,aFile);
		addtexttoarea(SetUnderlineOff,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		TLTOARR(checklength,"========================================================",aFile);
		
		addtexttoarea(SetMiddleAlignment,aFile);
		TLTOARR(checklength,ORr.Addr0,aFile);
		
		addtexttoarea(chr(13) & chr(10),aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		//Cut receipt  
		addtexttoarea(chr(29) & chr(86) & "1",aFile);
  
end;

global 
updating procedure HandleBixolonWarrantyMAC(record ORVc ORr,var area aFile,boolean bixolonnewimg,integer garmonths,string needprint)
begin
	string 10 SetLeftAlignment,SetRightAlignment,SetMiddleAlignment,SetTextSize,PrintImage;
	string 10 SetBoldOn,SetBoldOff,SetUnderlineOn,SetUnderlineOff;
	string 10 BigLetterOn,BigLetterOff,SmallLetterOn;
	string 100 SetFontA,SetFontB;
	string 10 rebate;
	val sumreb;
	integer checklength,rwcnt,i;
	row ORVc ORrw;
	integer k;
	vector string 255 text;
	string 255 tax_url;
	area qrArea;
	longint alen,ai;
	date selldate;
	record IVVc IVr;
	record SHVc SHr;
	
	
	checklength = 56;
	
	SetFontA = chr(27) & chr(33) & chr(0);
	SetFontB = chr(27) & chr(33) & chr(1);
	SetLeftAlignment = chr(27) & chr(97) & "0";
	SetMiddleAlignment = chr(27) & chr(97) & "1";
	SetRightAlignment = chr(27) & chr(97) & "2";
	SetBoldOn = chr(27) & chr(69) & "1";
	SetBoldOff = chr(27) & chr(69) & "0";
	SetUnderlineOn = chr(27) & chr(45) & "2";
	SetUnderlineOff = chr(27) & chr(45) & "0";
	BigLetterOn = chr(27) & chr(33)  & chr(32);
	SmallLetterOn = chr(27) & chr(33)  & chr(1);
	BigLetterOff = chr(27) & chr(33) & chr(0);
	PrintImage = chr(28) & chr(112) & chr(1) & chr(0);
	
	
	///1d 28 4c 06 00 30 45 30 30 01 01 0a
	if(bixolonnewimg)then begin
	  PrintImage = chr(29) & chr(40) & chr(76) & chr(6) &  chr(0) & chr(48) & chr(69) & chr(48) & chr(48) & chr(1) & chr(1);
	end;
	
	//SetAreaZeroSize(aFile);
	  selldate = ORr.OrdDate;
    IVr.OrderNr = ORr.SerNr;
    if(readfirstkey("OrderNr",IVr,1,true))then begin
      selldate = IVr.InvDate;
    end;
    SHr.OrderNr = ORr.SerNr;
    if (ReadLastKey("OrderKey",SHr,1,true)) then begin
      selldate = SHr.ShipDate;
    end;
	
		addtexttoarea(PrintImage,aFile);
		
		addtexttoarea(SetFontB,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		addtexttoarea(SetMiddleAlignment,aFile);
		addtexttoarea(SetBoldOn,aFile);
		TLTOARR(checklength,"ГАРАНТІЙНИЙ ТАЛОН ВІД ВИРОБНИКА",aFile);
		TLTOARR(checklength,"Обмежена річна гарантія Apple",aFile);
		addtexttoarea(SetBoldOff,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		addtexttoarea(SetLeftAlignment,aFile);
		TLTOARR(checklength,"========================================================",aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		rwcnt = MatRowCnt(ORr);
	  for(i=0;i<rwcnt;i=i+1) begin
      MatRowGet(ORr,i,ORrw);
      if(ORrw.stp==kInvoiceRowTypeNormal)then begin
        if(ORrw.GarantyFor>0 or (nonblank(needprint) and needprint==(ORrw.ArtCode & ":" & ORrw.SerialNr)))then begin
        
        
          addtexttoarea(SetUnderlineOff,aFile);
          TLTOARR(checklength,"НАЗВА ТОВАРУ:",aFile);
          addtexttoarea(SetUnderlineOn,aFile);
          TLTOARR(checklength,ORrw.Spec,aFile);
        
          addtexttoarea(SetUnderlineOff,aFile);
          TLTOARR(checklength,"СЕРІЙНИЙ НОМЕР: " & ORrw.SerialNr,aFile);
        
        
          TLTOARR(checklength,"ДАТА ПРОДАЖУ: " & selldate,aFile);
          addtexttoarea(SetBoldOn,aFile);
          TLTOARR(checklength,"ДАТА ЗАКІНЧЕННЯ ГАРАНТІЙНОГО ТЕРМІНУ: " & addmonth(selldate,garmonths),aFile);
          TLTOARR(checklength,"ТЕРМІН ГАРАНТІЇ (МІСЯЦІВ): " & garmonths,aFile);
          addtexttoarea(SetBoldOff,aFile);
          addtexttoarea(chr(13) & chr(10),aFile);
        end;
      end;
		end;
		
		addtexttoarea(SetBoldOff,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		TLTOARR(checklength,"========================================================",aFile);
		
		TLTOARR(checklength,"Шановний клієнте!",aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "Гарантійний термін експлуатації виробу дорівнює гарантійному строку. Строк гарантії відраховується з дати роздрібного продажу споживачеві.";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "У разі виявлення несправностей, для здійснення діагностики та ремонту, просимо Вас звертатися в сервісний центр:";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		text[""] = "Сервісний центр А-сервіс: ";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "        Адреса: Київ, вул.Бойчука 1/2";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "        Телефон: +380 (93) 170 45 00";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "        Веб-сайт:";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "        www.a-service.ua";
		TLTOARRVECTOR(checklength,text,aFile);
		
		
		addtexttoarea(chr(13) & chr(10),aFile);
		text[""] = "ОБМІН ТА ПОВЕРНЕННЯ ТОВАРУ";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
    TLTOARR(checklength,"Споживач перед придбанням товару перевіряє його комплектацію, відсутність пошкоджень або дефектів.",aFile);
		TLTOARR(checklength,"Обмін або повернення товару належної якості здійснюється протягом 14 днів.",aFile);
		text[""] = "Будь ласка, зверніть увагу, обміну або поверненню підлягає тільки новий товар, який не активований, який не був в експлуатації і";
		text[""] = text[""] & " не має слідів використання. Обов’язково повинно бути збережено: повний комплект товару, цілісність, неушкодженість та";
		text[""] = text[""] & " всі частини упаковки, ярлики, захисні плівки, заводське маркування.";
		TLTOARRVECTOR(checklength,text,aFile);
		 
		addtexttoarea(chr(13) & chr(10),aFile);
		text[""] = "ГАРАНТІЯ APPLE";
		TLTOARRVECTOR(checklength,text,aFile);
		
		text[""] = " Обмежена річна гарантія Apple є добровільною гарантією виробника. Вона надає права незалежно від прав, гарантованих законом про захист прав споживачів, зокрема щодо неякісних товарів.";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "Таким чином, умови обмеженої річної гарантії Apple надаються додатково до прав, установлених законом про захист прав споживачів, а не замість таких прав.";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = " Споживачі можуть вибирати, яким чином скористатися своїми правами: на основі обмеженої річної гарантії Apple або як передбачено законом про захист прав споживачів.";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "Важливо! Умови та положення обмеженої річної гарантії Apple не застосовуються до претензій, заявлених на підставі закону про захист прав споживачів.";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = " Додаткові відомості, що стосуються закону про захист прав споживачів, можна отримати на вебсайті Apple (www.apple.com/legal/warranty/statutoryrights.html) або в місцевій організації із захисту прав споживачів.";
		TLTOARRVECTOR(checklength,text,aFile);
		 
		addtexttoarea(chr(13) & chr(10),aFile);
		text[""] = "НА ЩО ПОШИРЮЄТЬСЯ ЦЯ ГАРАНТІЯ";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "Компанія Apple Distribution International Ltd, офіс якої розташовано за адресою Hollyhill Industrial Estate Hollyhill,";
		text[""] = text[""] & " Cork, Republic of Ireland (Республіка Ірландія), або її правонаступник (далі — Apple) надає гарантію, що поширюється на дефекти";
		text[""] = text[""] & " матеріалів і виготовлення в апаратному забезпеченні й аксесуарах Apple, які входили до комплекту постачання (далі — Продукт Apple)";
		text[""] = text[""] & " і використовувалися відповідно до посібників користувача Apple, технічних характеристик та інших опублікованих інструкцій щодо";
		text[""] = text[""] & " Продукту Apple. Гарантія діє протягом ОДНОГО (1) РОКУ з дати роздрібної покупки кінцевим користувачем (далі — Гарантійний період).";
		text[""] = text[""] & " Компенсацію за обмеженою річною гарантією для продукту Apple можна отримати в місцевих центрах обслуговування Apple у більшості";
		text[""] = text[""] & " країн світу (див. розділ «Порядок надання гарантійного обслуговування»). Якщо виявлено дефекти матеріалів або виготовлення,";
		text[""] = text[""] & " ви можете подати заявку на гарантійне обслуговування до компанії Apple, навіть якщо Продукт Apple було придбано в стороннього продавця.";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "Інформацію про особу, яка прийняла на себе зобов’язання щодо продукту Apple, придбаного в Королівстві Саудівська Аравія,";
		text[""] = text[""] & " Об’єднаних Арабських Еміратах чи Україні, див. На сторінці:";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "https://www.apple.com/legal/warranty/obligor.html";
		TLTOARRVECTOR(checklength,text,aFile);
		
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "Примітка. Усі претензії за обмеженою річною гарантією Apple розглядаються на умовах, визначених у цьому гарантійному документі.";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "Крім того, компанія Apple пропонує технічну підтримку телефоном протягом дев’яноста (90) днів із дати отримання продукту Apple.";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "(www.apple.com/legal/warranty/products/emea-vad-universal-warranty-ukranian.html)";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		TLTOARR(checklength,"========================================================",aFile);

		addtexttoarea(SetBoldOn,aFile);
		addtexttoarea(SetUnderlineOff,aFile);
		TLTOARR(checklength,"Ця гарантія не розповсюджується:",aFile);
		addtexttoarea(SetBoldOff,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "1.На косметичні пошкодження, включаючи, окрім іншого, подряпини, вм’ятини, та зламані пластикові деталі портів.";
		TLTOARRVECTOR(checklength,text,aFile);		
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "2.На пошкодження, викликані використанням виробів інших фірм.";
		TLTOARRVECTOR(checklength,text,aFile);
		
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "3.На недоліки, що були спричинені внаслідок недбалого поводження (включно, без обмеження, пошкодження, що заподіяні гострими предметами, вигинанням, стисканням, падінням, контактом з рідиною, вогнем";
		text[""] = text[""] & " тощо), чи спричинені неправильним використанням виробу, включаючи використання всупереч інструкціям, що супроводжують виріб.";

		TLTOARRVECTOR(checklength,text,aFile);
		
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "4.На пошкодження, спричинені землетрусами, нещасними випадками, дією непереборних сил, впливом на виріб магнітного чи іншого шкідливого випромінювання, потраплянням";
    text[""] = text[""] & " всередину виробу сторонніх предметів, у тому числі комах, збоями в роботі або невідповідністю стандартам мереж електроживлення, навмисними або необережними діями з вашого боку, або з боку третіх осіб.";
    TLTOARRVECTOR(checklength,text,aFile);
    		
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "5.Якщо виріб було відкрито, модифіковано або відремонтовано особою,  що не є представником уповноваженого сервісного центру, якщо цей виріб відремонтовано з";
		text[""] = text[""] & "використанням несанкціонованих запасних частин, коли серійний номер виробу було видалено, витерто, затерто, змінено, чи він є нерозбірливим, або у разі, якщо пошкодження виникли внаслідок обслуговування(включаючи оновлення та розширення).";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "6.На пошкодження, спричинені внаслідок використання виробу не у відповідності з опублікованими рекомендаціями компанії виробника.";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "7.Якщо виріб піддавався впливу зовнішніх факторів (наприклад корозії, окислюванню та ін.) або перебував поза дозволеного виробником діапазону температури, вологості та ін., який вказано в технічних";
		text[""] = text[""] & " специфікаціях, або на нього проливалася їжа або рідина, чи мали вплив хімічні речовини.";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "8.На дефекти, які виникли у зв’язку з нормальним зносом або нормальним старінням виробу.";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "9.На збережену інформацію та налаштування користувача (фотографії, музика, пошта, контакти та ін.)";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "ДІЇ КОМПАНІЇ APPLE У РАЗІ ОТРИМАННЯ ГАРАНТІЙНОЇ ПРЕТЕНЗІЇ";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "Якщо протягом Гарантійного періоду ви звертаєтеся до компанії Apple на підставі цієї гарантії, компанія Apple на власний розсуд:";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "(i) відремонтує Продукт Apple, застосувавши нові або раніше використовувані деталі Apple, які були перевірені та відповідають функціональним вимогам Apple; або";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);

    text[""] = "(ii) замінить Продукт Apple таким самим продуктом (або, за вашою згодою, таким, що має аналогічні чи в цілому подібні характеристики, що й оригінальний продукт,";
    text[""] = text[""] & "наприклад іншою моделлю з тими самими функціями або тією самою моделлю іншого кольору), який є новим або складається з нових і/або раніше використовуваних оригінальних деталей Apple,";
    text[""] = text[""] & "що були перевірені та відповідають функціональним вимогам Apple; або";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);

    text[""] = "(iii) поверне вам витрачені кошти в обмін на дефектний Продукт Apple.";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "Зверніть увагу, що замінний продукт або замінні деталі переходять у вашу власність. А несправний продукт, повернений до компанії Apple, або його несправні деталі, стають її власністю.";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);

    addtexttoarea(SetMiddleAlignment,aFile);
    tax_url = "https://www.apple.com/legal/warranty/products/emea-vad-universal-warranty-ukranian.html";
    getQRCode(tax_url,qrArea);
    if(getarealength(qrArea)>100)then begin
      alen = CountLinesInArea(qrArea);
      for(ai=0;ai<alen;ai=ai+1)begin
        text[""] = convertstringfromcodepage("WINDOWS-1251",GetLineFromArea(qrArea,ai));
        addtexttoarea(text[""],aFile);
      end;
    end;
		addtexttoarea(SetLeftAlignment,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		
		text[""] = "Гарантія iStore для Mac " & garmonths & " місяців";
		TLTOARRVECTOR(checklength,text,aFile);
		if(garmonths==24)then begin
		  text[""] = garmonths & " місяця гарантії від заводських дефектів для Mac.";
		end else begin
		  text[""] = garmonths & " місяців гарантії від заводських дефектів для Mac.";
		end;
		TLTOARRVECTOR(checklength,text,aFile);
    text[""] = "Знижка 10% на ремонт, при негарантійному випадку";
		TLTOARRVECTOR(checklength,text,aFile);
		if(garmonths==12)then begin
		  text[""] = "Безкоштовна встановлення Microsoft Office 2019.";
		end;
		if(garmonths==24)then begin
		  text[""] = "Безкоштовна встановлення Microsoft Office 2021.";
		end;
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "Безкоштовна чистка від пилу з заміною термопасти один раз на час дii пакет";
		TLTOARRVECTOR(checklength,text,aFile);
		/*text[""] = "Оцінка Вашого iPhone + 5% більше від калькуляції на сайті, при здачі його у Trade-in.";
		TLTOARRVECTOR(checklength,text,aFile);*/
		text[""] = "Безкоштовна технічна консультація впродовж всього гарантійного терміну.";
		TLTOARRVECTOR(checklength,text,aFile);
	  
	  addtexttoarea(chr(13) & chr(10),aFile);
	  addtexttoarea(chr(13) & chr(10),aFile);
		
		
		addtexttoarea(SetBoldOn,aFile);
		addtexttoarea(SetUnderlineOn,aFile);
		text[""] = "Товар отримав у цілому стані та повній комплектації";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "3 умовами гарантії ознайомлений і згоден";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(SetBoldOff,aFile);
		addtexttoarea(SetUnderlineOff,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		TLTOARR(checklength,"========================================================",aFile);
		
		addtexttoarea(SetMiddleAlignment,aFile);
		TLTOARR(checklength,ORr.Addr0,aFile);
		
		addtexttoarea(chr(13) & chr(10),aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		//Cut receipt  
		addtexttoarea(chr(29) & chr(86) & "1",aFile);
  
end;


global 
updating procedure HandleBixolonWarrantyM(record ORVc ORr,var area aFile,boolean bixolonnewimg,integer garmonths,string needprint)
begin
	string 10 SetLeftAlignment,SetRightAlignment,SetMiddleAlignment,SetTextSize,PrintImage;
	string 10 SetBoldOn,SetBoldOff,SetUnderlineOn,SetUnderlineOff;
	string 10 BigLetterOn,BigLetterOff,SmallLetterOn;
	string 100 SetFontA,SetFontB;
	string 10 rebate;
	val sumreb;
	integer checklength,rwcnt,i;
	row ORVc ORrw;
	integer k;
	vector string 255 text;
	string 255 tax_url;
	area qrArea;
	longint alen,ai;
	date selldate;
	record IVVc IVr;
	record SHVc SHr;
	
	checklength = 56;
	
	SetFontA = chr(27) & chr(33) & chr(0);
	SetFontB = chr(27) & chr(33) & chr(1);
	SetLeftAlignment = chr(27) & chr(97) & "0";
	SetMiddleAlignment = chr(27) & chr(97) & "1";
	SetRightAlignment = chr(27) & chr(97) & "2";
	SetBoldOn = chr(27) & chr(69) & "1";
	SetBoldOff = chr(27) & chr(69) & "0";
	SetUnderlineOn = chr(27) & chr(45) & "2";
	SetUnderlineOff = chr(27) & chr(45) & "0";
	BigLetterOn = chr(27) & chr(33)  & chr(32);
	SmallLetterOn = chr(27) & chr(33)  & chr(1);
	BigLetterOff = chr(27) & chr(33) & chr(0);
	PrintImage = chr(28) & chr(112) & chr(1) & chr(0);
	
	
	///1d 28 4c 06 00 30 45 30 30 01 01 0a
	if(bixolonnewimg)then begin
	  PrintImage = chr(29) & chr(40) & chr(76) & chr(6) &  chr(0) & chr(48) & chr(69) & chr(48) & chr(48) & chr(1) & chr(1);
	end;
	
	//SetAreaZeroSize(aFile);
	
	  selldate = ORr.OrdDate;
    IVr.OrderNr = ORr.SerNr;
    if(readfirstkey("OrderNr",IVr,1,true))then begin
      selldate = IVr.InvDate;
    end;
    SHr.OrderNr = ORr.SerNr;
    if (ReadLastKey("OrderKey",SHr,1,true)) then begin
      selldate = SHr.ShipDate;
    end;
        
		addtexttoarea(PrintImage,aFile);
		
		addtexttoarea(SetFontB,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		addtexttoarea(SetMiddleAlignment,aFile);
		addtexttoarea(SetBoldOn,aFile);
		TLTOARR(checklength,"ГАРАНТІЙНИЙ ТАЛОН iSTORE",aFile);
		addtexttoarea(SetBoldOff,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		addtexttoarea(SetLeftAlignment,aFile);
		
		rwcnt = MatRowCnt(ORr);
	  for(i=0;i<rwcnt;i=i+1) begin
      MatRowGet(ORr,i,ORrw);
      if(ORrw.stp==kInvoiceRowTypeNormal)then begin
        if(ORrw.GarantyFor>0 and (blank(needprint) or needprint==(ORrw.ArtCode & ":" & ORrw.SerialNr)))then begin
          addtexttoarea(SetUnderlineOff,aFile);
          TLTOARR(checklength,"НАЗВА ТОВАРУ:",aFile);
          addtexttoarea(SetUnderlineOn,aFile);
          TLTOARR(checklength,ORrw.Spec,aFile);
        
          addtexttoarea(SetUnderlineOff,aFile);
          TLTOARR(checklength,"СЕРІЙНИЙ НОМЕР: " & ORrw.SerialNr,aFile);
        
        
        
        
          TLTOARR(checklength,"ДАТА ПРОДАЖУ: " & selldate,aFile);
          TLTOARR(checklength,"ДАТА ЗАКІНЧЕННЯ ГАРАНТІЙНОГО ТЕРМІНУ:" & addmonth(selldate,garmonths),aFile);
          addtexttoarea(SetBoldOn,aFile);
          TLTOARR(checklength,"ТЕРМІН ГАРАНТІЇ (МІСЯЦІВ): " & garmonths,aFile);
          addtexttoarea(chr(13) & chr(10),aFile);
        end;
      end;
		end;
		
		addtexttoarea(SetBoldOff,aFile);
		
		addtexttoarea(chr(13) & chr(10),aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
    
    text[""] = "Гарантійний термін  експлуатації виробу дорівнює гарантійному строку. Строк гарантії відраховується з дати роздрібного продажу споживачеві.";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "У разі виявлення несправностей, для здійснення діагностики та ремонту, просимо Вас звертатися в магазин, в якому була здійснена покупка або сервісний центр:";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		text[""] = "Сервісний центр А-сервіс:";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "        Адреса: Київ, вул.Бойчука 1/2";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "        Телефон: +380 (93) 170 45 00";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "        Веб-сайт:";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "        www.a-service.ua";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
    
    text[""] = "Магазини iStore:";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "        Телефон: 0 800 330 334";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "        Веб-сайт:";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "        www.istore.ua/ua/stores/";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "ОБМІН ТА ПОВЕРНЕННЯ ТОВАРУ";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		text[""] = "Споживач перед придбанням товару перевіряє його комплектацію, відсутність пошкоджень або дефектів.";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "Обмін або повернення товару належної якості здійснюється протягом 14 днів.";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "Будь ласка, зверніть увагу, обміну або поверненню підлягає тільки новий товар, який не активований, який не був в експлуатації і не має слідів використання.";
		text[""] = text[""]  & " Обов`язково повинно бути збережено: повний комплект товару, цілісність, неушкодженість та всі частини упаковки, ярлики, захисні плівки, заводське маркування.";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		
		
		
		text[""] = "ЦЯ ГАРАНТІЯ ПОКРИВАЄ";
		TLTOARRVECTOR(checklength,text,aFile);
    addtexttoarea(chr(13) & chr(10),aFile);
    
    text[""] = "Гарантія від iStore - це турбота про Ваш iPhone, iPad та Apple Watch.";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		text[""] = " - Гарантійне обслуговування. У разі виявлення заводського дефекту, ми зробимо заміну пристрою на новий, протягом 1-5 днів.";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = " - Повне налаштування та підтримка нового пристрою.";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = " - Безкоштовне захисне скло Base або преміальне захисне скло зі знижкою у 10% на iPhone або iPad.";
		TLTOARRVECTOR(checklength,text,aFile);
		/*text[""] = " - Оцінка Вашого iPhone + 5% більше від калькуляції на сайті, при здачі його у Trade-in.";
		TLTOARRVECTOR(checklength,text,aFile);*/
    addtexttoarea(chr(13) & chr(10),aFile);
    
    
    text[""] = "Гарантія iStore для AirPods";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		text[""] = " - Гарантійне обслуговування. У разі виявлення заводського дефекту, ми зробимо заміну непрацюючого елементу на новий, від 1 до 5 днів.";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = " - Налаштування та підтримка нового пристрою.";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = " - Одна безкоштовна чистка протягом дії пакету.";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = " - Налаштування підписки AppleMusic.";
		TLTOARRVECTOR(checklength,text,aFile);
    addtexttoarea(chr(13) & chr(10),aFile);
    
    text[""] = "Гарантія iStore для Mac";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		if(garmonths==12)then begin
      text[""] = " - 12 місяців гарантії від заводських дефектів для Mac.";
      TLTOARRVECTOR(checklength,text,aFile);
		end;
		if(garmonths==24)then begin
      text[""] = " - 24 місяця гарантії від заводських дефектів для Mac.";
      TLTOARRVECTOR(checklength,text,aFile);
		end;
		
		text[""] = " - Знижка 10% на ремонт, при негарантійному випадку.";
		TLTOARRVECTOR(checklength,text,aFile);
		
		if(garmonths==12)then begin
      text[""] = " - Безкоштовна встановлення Microsoft Office 2019.";
		  TLTOARRVECTOR(checklength,text,aFile);
		end;
		if(garmonths==24)then begin
      text[""] = " - Безкоштовна встановлення Microsoft Office 2021.";
		  TLTOARRVECTOR(checklength,text,aFile);
		end;
		
		text[""] = " - Безкоштовна чистка від пилу з заміною термопасти один раз на час дii пакету.";
		TLTOARRVECTOR(checklength,text,aFile);
		/*text[""] = " - Оцінка Вашого iPhone + 5% більше від калькуляції на сайті, при здачі його у Trade-in.";
		TLTOARRVECTOR(checklength,text,aFile);*/
		text[""] = " - Безкоштовна технічна консультація впродовж всього гарантійного терміну.";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
    
    text[""] = "Гарантія iStore для Mac";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		text[""] = " - 24 місяца гарантії від заводських дефектів для Mac.";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = " - Знижка 10% на ремонт, при негарантійному випадку.";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = " - Безкоштовна встановлення Microsoft Office 2021.";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = " - Безкоштовна чистка від пилу з заміною термопасти один раз на час дii пакету.";
		TLTOARRVECTOR(checklength,text,aFile);
		/*text[""] = " - Оцінка Вашого iPhone + 5% більше від калькуляції на сайті, при здачі його у Trade-in.";
		TLTOARRVECTOR(checklength,text,aFile);*/
		text[""] = " - Безкоштовна технічна консультація впродовж всього гарантійного терміну.";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
    
    /*
    text[""] = "1. У випадку підтвердженого заводського дефекту сервісним центром, Ви маєте право на заміну, протягом 3-5 робочих днів, на новий пристрій або на аналогічний.";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		text[""] = "У випадку заміни пристрою – комплект та коробка пристрою не підлягає заміні та строк гарантійного терміну не подовжується, а залишається незмінним з дати покупки пристрою.";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		text[""] = "2.  У випадку, коли з пристроєм було придбане та наклеєно скло або плівка, у разі заміни пристрою вартість скла або плівки не компенсується магазином. ";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		text[""] = "3. Магазин та сервісний центр не несуть відповідальності за пошкодження або втрату особистого контенту, налаштувань, даних користувача та будь-яких файлів, що знаходяться на пристою.";
		TLTOARRVECTOR(checklength,text,aFile);*/
		
		
		addtexttoarea(chr(13) & chr(10),aFile);		
		addtexttoarea(chr(13) & chr(10),aFile);
    
		addtexttoarea(SetBoldOn,aFile);
		addtexttoarea(SetUnderlineOff,aFile);
		TLTOARR(checklength,"ЦЯ ГАРАНТІЯ НЕ РОЗПОВСЮДЖУЄТЬСЯ",aFile);
		addtexttoarea(SetBoldOff,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "1.На косметичні пошкодження, включаючи, окрім іншого, подряпини, вм’ятини, та зламані пластикові деталі портів.";
		TLTOARRVECTOR(checklength,text,aFile);
		
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "2.На пошкодження, викликані використанням виробів інших фірм.";
		TLTOARRVECTOR(checklength,text,aFile);
		
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "3.На недоліки, що були спричинені внаслідок недбалого поводження (включно, без обмеження, пошкодження, що заподіяні гострими предметами, вигинанням, стисканням, падінням, контактом з рідиною,";
		text[""] = text[""] & " вогнем тощо), чи спричинені неправильним використанням виробу, включаючи використання всупереч інструкціям, що супроводжують виріб.";

		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "4.На пошкодження, спричинені землетрусами, нещасними випадками, дією непереборних сил, впливом на виріб магнітного чи іншого шкідливого випромінювання, потраплянням всередину виробу сторонніх";
		text[""] = text[""] & " предметів, у тому числі комах, збоями в роботі або невідповідністю стандартам мереж електроживлення, навмисними або необережними діями з вашого боку, або з боку третіх осіб.";
    TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "5.Якщо виріб було відкрито, модифіковано або відремонтовано особою, що не є представником уповноваженого сервісного центру, якщо цей виріб відремонтовано звикористанням несанкціонованих запасних";
		text[""] = text[""] & " частин, коли серійний номер виробу було видалено, витерто, затерто, змінено, чи він є нерозбірливим, або у разі, якщо пошкодження виникли внаслідок обслуговування (включаючи оновлення та розширення).";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "6.На пошкодження, спричинені внаслідок використання виробу не у відповідності з опублікованими рекомендаціями компанії виробника.";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "7.Якщо виріб піддавався впливу зовнішніх факторів (наприклад корозії, окислюванню та ін.) або перебував поза дозволеного виробником діапазону температури, вологості та ін., який вказано в технічних";
		text[""] = text[""] & " специфікаціях, або на нього проливалася їжа або рідина, чи мали вплив хімічні речовини.";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "8.На дефекти, які виникли у зв’язку з нормальним зносом або нормальним старінням виробу.";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "9.На збережену інформацію та налаштування користувача (фотографії, музика, пошта, контакти та ін.)";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "ДІЇ КОМПАНІЇ APPLE У РАЗІ ОТРИМАННЯ ГАРАНТІЙНОЇ ПРЕТЕНЗІЇ";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "Якщо протягом Гарантійного періоду ви звертаєтеся до компанії Apple на підставі цієї гарантії, компанія Apple на власний розсуд:";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "(i) відремонтує Продукт Apple, застосувавши нові або раніше використовувані деталі Apple, які були перевірені та відповідають функціональним вимогам Apple; або";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);

    text[""] = "(ii) замінить Продукт Apple таким самим продуктом (або, за вашою згодою, таким, що має аналогічні чи в цілому подібні характеристики, що й оригінальний продукт,";
    text[""] = text[""] & "наприклад іншою моделлю з тими самими функціями або тією самою моделлю іншого кольору), який є новим або складається з нових і/або раніше використовуваних оригінальних деталей Apple,";
    text[""] = text[""] & "що були перевірені та відповідають функціональним вимогам Apple; або";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);

    text[""] = "(iii) поверне вам витрачені кошти в обмін на дефектний Продукт Apple.";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "Зверніть увагу, що замінний продукт або замінні деталі переходять у вашу власність. А несправний продукт, повернений до компанії Apple, або його несправні деталі, стають її власністю.";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);

    addtexttoarea(SetMiddleAlignment,aFile);
    tax_url = "https://www.apple.com/legal/warranty/products/emea-vad-universal-warranty-ukranian.html";
    getQRCode(tax_url,qrArea);
    if(getarealength(qrArea)>100)then begin
      alen = CountLinesInArea(qrArea);
      for(ai=0;ai<alen;ai=ai+1)begin
        text[""] = convertstringfromcodepage("WINDOWS-1251",GetLineFromArea(qrArea,ai));
        addtexttoarea(text[""],aFile);
      end;
    end;
		addtexttoarea(SetLeftAlignment,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		addtexttoarea(SetBoldOn,aFile);
		addtexttoarea(SetUnderlineOn,aFile);
		TLTOARR(checklength,"Товар отримав у цілому стані та повній комплектації",aFile);
		TLTOARR(checklength,"3 умовами гарантії ознайомлений і згоден",aFile);
		addtexttoarea(SetBoldOff,aFile);
		addtexttoarea(SetUnderlineOff,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		TLTOARR(checklength,"========================================================",aFile);
		
		addtexttoarea(SetMiddleAlignment,aFile);
		TLTOARR(checklength,ORr.Addr0,aFile);
		
		addtexttoarea(chr(13) & chr(10),aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		//Cut receipt  
		addtexttoarea(chr(29) & chr(86) & "1",aFile);
end;



global 
updating procedure HandleBixolonWarrantyMplusS(record ORVc ORr,var area aFile,boolean bixolonnewimg,integer garmonths,string needprint)
begin
	string 10 SetLeftAlignment,SetRightAlignment,SetMiddleAlignment,SetTextSize,PrintImage;
	string 10 SetBoldOn,SetBoldOff,SetUnderlineOn,SetUnderlineOff;
	string 10 BigLetterOn,BigLetterOff,SmallLetterOn;
	string 100 SetFontA,SetFontB;
	string 10 rebate;
	val sumreb;
	integer checklength,rwcnt,i;
	row ORVc ORrw;
	integer k;
	vector string 255 text;
	string 255 tax_url;
	area qrArea;
	longint alen,ai;
	date selldate;
	record IVVc IVr;
	record SHVc SHr;
	
	checklength = 56;
	
	SetFontA = chr(27) & chr(33) & chr(0);
	SetFontB = chr(27) & chr(33) & chr(1);
	SetLeftAlignment = chr(27) & chr(97) & "0";
	SetMiddleAlignment = chr(27) & chr(97) & "1";
	SetRightAlignment = chr(27) & chr(97) & "2";
	SetBoldOn = chr(27) & chr(69) & "1";
	SetBoldOff = chr(27) & chr(69) & "0";
	SetUnderlineOn = chr(27) & chr(45) & "2";
	SetUnderlineOff = chr(27) & chr(45) & "0";
	BigLetterOn = chr(27) & chr(33)  & chr(32);
	SmallLetterOn = chr(27) & chr(33)  & chr(1);
	BigLetterOff = chr(27) & chr(33) & chr(0);
	PrintImage = chr(28) & chr(112) & chr(1) & chr(0);
	
	
	///1d 28 4c 06 00 30 45 30 30 01 01 0a
	if(bixolonnewimg)then begin
	  PrintImage = chr(29) & chr(40) & chr(76) & chr(6) &  chr(0) & chr(48) & chr(69) & chr(48) & chr(48) & chr(1) & chr(1);
	end;
	
	//SetAreaZeroSize(aFile);
	
	  selldate = ORr.OrdDate;
    IVr.OrderNr = ORr.SerNr;
    if(readfirstkey("OrderNr",IVr,1,true))then begin
      selldate = IVr.InvDate;
    end;
    SHr.OrderNr = ORr.SerNr;
    if (ReadLastKey("OrderKey",SHr,1,true)) then begin
      selldate = SHr.ShipDate;
    end;
        
		addtexttoarea(PrintImage,aFile);
		
		addtexttoarea(SetFontB,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		addtexttoarea(SetMiddleAlignment,aFile);
		addtexttoarea(SetBoldOn,aFile);
		TLTOARR(checklength,"ГАРАНТІЙНИЙ ТАЛОН iSTORE",aFile);
		addtexttoarea(SetBoldOff,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		addtexttoarea(SetLeftAlignment,aFile);
		
		rwcnt = MatRowCnt(ORr);
	  for(i=0;i<rwcnt;i=i+1) begin
      MatRowGet(ORr,i,ORrw);
      if(ORrw.stp==kInvoiceRowTypeNormal)then begin
        if(ORrw.GarantyFor>0 and (blank(needprint) or needprint==(ORrw.ArtCode & ":" & ORrw.SerialNr)))then begin
          addtexttoarea(SetUnderlineOff,aFile);
          TLTOARR(checklength,"НАЗВА ТОВАРУ:",aFile);
          addtexttoarea(SetUnderlineOn,aFile);
          TLTOARR(checklength,ORrw.Spec,aFile);
        
          addtexttoarea(SetUnderlineOff,aFile);
          TLTOARR(checklength,"СЕРІЙНИЙ НОМЕР: " & ORrw.SerialNr,aFile);
        
        
        
        
          TLTOARR(checklength,"ДАТА ПРОДАЖУ: " & selldate,aFile);
          TLTOARR(checklength,"ДАТА ЗАКІНЧЕННЯ ГАРАНТІЙНОГО ТЕРМІНУ:" & addmonth(selldate,garmonths),aFile);
          addtexttoarea(SetBoldOn,aFile);
          TLTOARR(checklength,"ТЕРМІН ГАРАНТІЇ (МІСЯЦІВ): " & garmonths,aFile);
          addtexttoarea(chr(13) & chr(10),aFile);
        end;
      end;
		end;
		
		addtexttoarea(SetBoldOff,aFile);
		
		addtexttoarea(chr(13) & chr(10),aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
    
    text[""] = "Гарантійний термін  експлуатації виробу дорівнює гарантійному строку. Строк гарантії відраховується з дати роздрібного продажу споживачеві.";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "У разі виявлення несправностей, для здійснення діагностики та ремонту, просимо Вас звертатися в магазин, в якому була здійснена покупка або сервісний центр:";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		text[""] = "Сервісний центр А-сервіс:";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "        Адреса: Київ, вул.Бойчука 1/2";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "        Телефон: +380 (93) 170 45 00";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "        Веб-сайт:";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "        www.a-service.ua";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
    
    text[""] = "Магазини iStore:";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "        Телефон: 0 800 330 334";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "        Веб-сайт:";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "        www.istore.ua/ua/stores/";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "ОБМІН ТА ПОВЕРНЕННЯ ТОВАРУ";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		text[""] = "Споживач перед придбанням товару перевіряє його комплектацію, відсутність пошкоджень або дефектів.";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "Обмін або повернення товару належної якості здійснюється протягом 14 днів.";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "Будь ласка, зверніть увагу, обміну або поверненню підлягає тільки новий товар, який не активований, який не був в експлуатації і не має слідів використання.";
		text[""] = text[""]  & " Обов`язково повинно бути збережено: повний комплект товару, цілісність, неушкодженість та всі частини упаковки, ярлики, захисні плівки, заводське маркування.";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		
		
		
		text[""] = "ЦЯ ГАРАНТІЯ ПОКРИВАЄ";
		TLTOARRVECTOR(checklength,text,aFile);
    addtexttoarea(chr(13) & chr(10),aFile);
    
    text[""] = "Гарантія iStore + захист iPhone";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		text[""] = " - Одноразова безкоштовна заміна дисплею або скла.";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = " - Одноразова безкоштовна заміна скла задньої панелі.";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = " - Безкоштовна заміна АКБ, якщо його ємність менше 79%";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = " - Знижка 10% на преміальне захисне скло для iPhone.";
		TLTOARRVECTOR(checklength,text,aFile);
    addtexttoarea(chr(13) & chr(10),aFile);
    
    
    text[""] = "Гарантія iStore + захист MacBook";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		text[""] = "У разі винекнення пошкодження, Ви можете пологадити свій Mac, але не більше трьох звернень за календарний рік, додатково, у разі настаня сервісного випадку стягується комісія за обслуговування у розмірі:";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = " - 4999 грн за пошкодження екрану чи зовнішнього корпусу";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = " - 10999 грн. за інше випадкове пошкодження.";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "Усунення пошкоджень проводитися в сервісному центрі, відповідно до регламенту. Сервісний центр на власний розсуд виконує ремонт чи заміну несправного модуля.";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "Додаткові переваги захисту для Mac :";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = " - Безкоштовне встановлення Microsoft Office 2019.";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = " - Чистка від пилу з заміною термопасти один раз на час дii пакету.";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = " - Технічна консультація впродовж всього гарантійного терміну.";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = " - Підмінний фонд на час ремонту.";
		TLTOARRVECTOR(checklength,text,aFile);
		
    addtexttoarea(chr(13) & chr(10),aFile);
    
    text[""] = "Гарантія iStore + захист AirPods";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
    text[""] = "Гарантійне обслуговування, пов’язане з будь-яким заводськими дефектом або механічними пошкодженнями:";
    TLTOARRVECTOR(checklength,text,aFile);
    
    text[""] = " - Гарантійне обслуговування. У разі виявлення заводського дефекту, ми зробимо заміну непрацюючого елементу на новий, протягом 1-5 днів.";
    TLTOARRVECTOR(checklength,text,aFile);
    text[""] = " - Однарозова заміна при механічних пошкодженнях, такі як (попадання вологи, незначні тріщини, потертості) ми зробимо заміну пошкодженого елементу на новий, протягом 1-5 днів. *";
    TLTOARRVECTOR(checklength,text,aFile);
    text[""] = "*не покриває втрату";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = " - Налаштування та підтримка нового пристрою.";
    TLTOARRVECTOR(checklength,text,aFile);
    text[""] = " - Одна безкоштовна чистка протягом дії пакету.";
    TLTOARRVECTOR(checklength,text,aFile);
    text[""] = " - Налаштування підписки AppleMusic.";
    TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
    
    /*
    text[""] = "1. У випадку підтвердженого заводського дефекту сервісним центром, Ви маєте право на заміну, протягом 3-5 робочих днів, на новий пристрій або на аналогічний.";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		text[""] = "У випадку заміни пристрою – комплект та коробка пристрою не підлягає заміні та строк гарантійного терміну не подовжується, а залишається незмінним з дати покупки пристрою.";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		text[""] = "2.  У випадку, коли з пристроєм було придбане та наклеєно скло або плівка, у разі заміни пристрою вартість скла або плівки не компенсується магазином. ";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		text[""] = "3. Магазин та сервісний центр не несуть відповідальності за пошкодження або втрату особистого контенту, налаштувань, даних користувача та будь-яких файлів, що знаходяться на пристою.";
		TLTOARRVECTOR(checklength,text,aFile);*/
		
		
		addtexttoarea(chr(13) & chr(10),aFile);		
		addtexttoarea(chr(13) & chr(10),aFile);
    
		addtexttoarea(SetBoldOn,aFile);
		addtexttoarea(SetUnderlineOff,aFile);
		TLTOARR(checklength,"ЦЯ ГАРАНТІЯ НЕ РОЗПОВСЮДЖУЄТЬСЯ",aFile);
		addtexttoarea(SetBoldOff,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "1.На косметичні пошкодження, включаючи, окрім іншого, подряпини, вм’ятини, та зламані пластикові деталі портів.";
		TLTOARRVECTOR(checklength,text,aFile);
		
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "2.На пошкодження, викликані використанням виробів інших фірм.";
		TLTOARRVECTOR(checklength,text,aFile);
		
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "3.На недоліки, що були спричинені внаслідок недбалого поводження (включно, без обмеження, пошкодження, що заподіяні гострими предметами, вигинанням, стисканням, падінням, контактом з рідиною,";
		text[""] = text[""] & " вогнем тощо), чи спричинені неправильним використанням виробу, включаючи використання всупереч інструкціям, що супроводжують виріб.";

		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "4.На пошкодження, спричинені землетрусами, нещасними випадками, дією непереборних сил, впливом на виріб магнітного чи іншого шкідливого випромінювання, потраплянням всередину виробу сторонніх";
		text[""] = text[""] & " предметів, у тому числі комах, збоями в роботі або невідповідністю стандартам мереж електроживлення, навмисними або необережними діями з вашого боку, або з боку третіх осіб.";
    TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "5.Якщо виріб було відкрито, модифіковано або відремонтовано особою, що не є представником уповноваженого сервісного центру, якщо цей виріб відремонтовано звикористанням несанкціонованих запасних";
		text[""] = text[""] & " частин, коли серійний номер виробу було видалено, витерто, затерто, змінено, чи він є нерозбірливим, або у разі, якщо пошкодження виникли внаслідок обслуговування (включаючи оновлення та розширення).";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "6.На пошкодження, спричинені внаслідок використання виробу не у відповідності з опублікованими рекомендаціями компанії виробника.";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "7.Якщо виріб піддавався впливу зовнішніх факторів (наприклад корозії, окислюванню та ін.) або перебував поза дозволеного виробником діапазону температури, вологості та ін., який вказано в технічних";
		text[""] = text[""] & " специфікаціях, або на нього проливалася їжа або рідина, чи мали вплив хімічні речовини.";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "8.На дефекти, які виникли у зв’язку з нормальним зносом або нормальним старінням виробу.";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "9.На збережену інформацію та налаштування користувача (фотографії, музика, пошта, контакти та ін.)";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "ДІЇ КОМПАНІЇ APPLE У РАЗІ ОТРИМАННЯ ГАРАНТІЙНОЇ ПРЕТЕНЗІЇ";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "Якщо протягом Гарантійного періоду ви звертаєтеся до компанії Apple на підставі цієї гарантії, компанія Apple на власний розсуд:";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "(i) відремонтує Продукт Apple, застосувавши нові або раніше використовувані деталі Apple, які були перевірені та відповідають функціональним вимогам Apple; або";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);

    text[""] = "(ii) замінить Продукт Apple таким самим продуктом (або, за вашою згодою, таким, що має аналогічні чи в цілому подібні характеристики, що й оригінальний продукт,";
    text[""] = text[""] & "наприклад іншою моделлю з тими самими функціями або тією самою моделлю іншого кольору), який є новим або складається з нових і/або раніше використовуваних оригінальних деталей Apple,";
    text[""] = text[""] & "що були перевірені та відповідають функціональним вимогам Apple; або";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);

    text[""] = "(iii) поверне вам витрачені кошти в обмін на дефектний Продукт Apple.";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "Зверніть увагу, що замінний продукт або замінні деталі переходять у вашу власність. А несправний продукт, повернений до компанії Apple, або його несправні деталі, стають її власністю.";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);

    addtexttoarea(SetMiddleAlignment,aFile);
    tax_url = "https://www.apple.com/legal/warranty/products/emea-vad-universal-warranty-ukranian.html";
    getQRCode(tax_url,qrArea);
    if(getarealength(qrArea)>100)then begin
      alen = CountLinesInArea(qrArea);
      for(ai=0;ai<alen;ai=ai+1)begin
        text[""] = convertstringfromcodepage("WINDOWS-1251",GetLineFromArea(qrArea,ai));
        addtexttoarea(text[""],aFile);
      end;
    end;
		addtexttoarea(SetLeftAlignment,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		addtexttoarea(SetBoldOn,aFile);
		addtexttoarea(SetUnderlineOn,aFile);
		TLTOARR(checklength,"Товар отримав у цілому стані та повній комплектації",aFile);
		TLTOARR(checklength,"3 умовами гарантії ознайомлений і згоден",aFile);
		addtexttoarea(SetBoldOff,aFile);
		addtexttoarea(SetUnderlineOff,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		TLTOARR(checklength,"========================================================",aFile);
		
		addtexttoarea(SetMiddleAlignment,aFile);
		TLTOARR(checklength,ORr.Addr0,aFile);
		
		addtexttoarea(chr(13) & chr(10),aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		//Cut receipt  
		addtexttoarea(chr(29) & chr(86) & "1",aFile);
end;



global 
updating procedure HandleBixolonWarrantyDyson(record ORVc ORr,var area aFile,boolean bixolonnewimg,integer garmonths,string needprint)
begin
	string 10 SetLeftAlignment,SetRightAlignment,SetMiddleAlignment,SetTextSize,PrintImage;
	string 10 SetBoldOn,SetBoldOff,SetUnderlineOn,SetUnderlineOff;
	string 10 BigLetterOn,BigLetterOff,SmallLetterOn;
	string 100 SetFontA,SetFontB;
	string 10 rebate;
	val sumreb;
	integer checklength,rwcnt,i;
	row ORVc ORrw;
	integer k;
	vector string 255 text;
	string 255 tax_url;
	area qrArea;
	longint alen,ai;
	date selldate;
	record IVVc IVr;
	record SHVc SHr;
	
	checklength = 56;
	
	SetFontA = chr(27) & chr(33) & chr(0);
	SetFontB = chr(27) & chr(33) & chr(1);
	SetLeftAlignment = chr(27) & chr(97) & "0";
	SetMiddleAlignment = chr(27) & chr(97) & "1";
	SetRightAlignment = chr(27) & chr(97) & "2";
	SetBoldOn = chr(27) & chr(69) & "1";
	SetBoldOff = chr(27) & chr(69) & "0";
	SetUnderlineOn = chr(27) & chr(45) & "2";
	SetUnderlineOff = chr(27) & chr(45) & "0";
	BigLetterOn = chr(27) & chr(33)  & chr(32);
	SmallLetterOn = chr(27) & chr(33)  & chr(1);
	BigLetterOff = chr(27) & chr(33) & chr(0);
	PrintImage = chr(28) & chr(112) & chr(1) & chr(0);
	
	
	///1d 28 4c 06 00 30 45 30 30 01 01 0a
	if(bixolonnewimg)then begin
	  PrintImage = chr(29) & chr(40) & chr(76) & chr(6) &  chr(0) & chr(48) & chr(69) & chr(48) & chr(48) & chr(1) & chr(1);
	end;
	
	//SetAreaZeroSize(aFile);
	
	  selldate = ORr.OrdDate;
    IVr.OrderNr = ORr.SerNr;
    if(readfirstkey("OrderNr",IVr,1,true))then begin
      selldate = IVr.InvDate;
    end;
    SHr.OrderNr = ORr.SerNr;
    if (ReadLastKey("OrderKey",SHr,1,true)) then begin
      selldate = SHr.ShipDate;
    end;
        
		addtexttoarea(PrintImage,aFile);
		
		addtexttoarea(SetFontB,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		addtexttoarea(SetMiddleAlignment,aFile);
		addtexttoarea(SetBoldOn,aFile);
		TLTOARR(checklength,"ГАРАНТІЙНИЙ ТАЛОН iSTORE",aFile);
		addtexttoarea(SetBoldOff,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		addtexttoarea(SetLeftAlignment,aFile);
		
		rwcnt = MatRowCnt(ORr);
	  for(i=0;i<rwcnt;i=i+1) begin
      MatRowGet(ORr,i,ORrw);
      if(ORrw.stp==kInvoiceRowTypeNormal)then begin
        if(ORrw.GarantyFor>0 and (blank(needprint) or needprint==(ORrw.ArtCode & ":" & ORrw.SerialNr)))then begin
          addtexttoarea(SetUnderlineOff,aFile);
          TLTOARR(checklength,"НАЗВА ТОВАРУ:",aFile);
          addtexttoarea(SetUnderlineOn,aFile);
          TLTOARR(checklength,ORrw.Spec,aFile);
        
          addtexttoarea(SetUnderlineOff,aFile);
          TLTOARR(checklength,"СЕРІЙНИЙ НОМЕР: " & ORrw.SerialNr,aFile);
        
        
        
        
          TLTOARR(checklength,"ДАТА ПРОДАЖУ: " & selldate,aFile);
          TLTOARR(checklength,"ДАТА ЗАКІНЧЕННЯ ГАРАНТІЙНОГО ТЕРМІНУ:" & addmonth(selldate,garmonths),aFile);
          addtexttoarea(SetBoldOn,aFile);
          TLTOARR(checklength,"ТЕРМІН ГАРАНТІЇ (МІСЯЦІВ): " & garmonths,aFile);
          addtexttoarea(chr(13) & chr(10),aFile);
        end;
      end;
		end;
		
		addtexttoarea(SetBoldOff,aFile);
		
		addtexttoarea(chr(13) & chr(10),aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
    
    text[""] = "Гарантійний термін  експлуатації виробу дорівнює гарантійному строку. Строк гарантії відраховується з дати роздрібного продажу споживачеві.";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "У разі виявлення несправностей, для здійснення діагностики та ремонту, просимо Вас звертатися в магазин, в якому була здійснена покупка або сервісний центр:";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		text[""] = "Сервісний центр А-сервіс:";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "        Адреса: Київ, вул.Бойчука 1/2";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "        Телефон: +380 (93) 170 45 00";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "        Веб-сайт:";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "        www.a-service.ua";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
    
    text[""] = "Магазини iStore:";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "        Телефон: 0 800 330 334";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "        Веб-сайт:";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "        www.istore.ua/ua/stores/";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "ОБМІН ТА ПОВЕРНЕННЯ ТОВАРУ";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		text[""] = "Споживач перед придбанням товару перевіряє його комплектацію, відсутність пошкоджень або дефектів.";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "Обмін або повернення товару належної якості здійснюється протягом 14 днів.";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "Будь ласка, зверніть увагу, обміну або поверненню підлягає тільки новий товар, який не активований, який не був в експлуатації і не має слідів використання.";
		text[""] = text[""]  & " Обов`язково повинно бути збережено: повний комплект товару, цілісність, неушкодженість та всі частини упаковки, ярлики, захисні плівки, заводське маркування.";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
    
		addtexttoarea(SetBoldOn,aFile);
		addtexttoarea(SetUnderlineOff,aFile);
		TLTOARR(checklength,"ЦЯ ГАРАНТІЯ НЕ РОЗПОВСЮДЖУЄТЬСЯ",aFile);
		addtexttoarea(SetBoldOff,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "1.На косметичні пошкодження, включаючи, окрім іншого, подряпини, вм’ятини, та зламані пластикові деталі портів.";
		TLTOARRVECTOR(checklength,text,aFile);
		
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "2.На пошкодження, викликані використанням виробів інших фірм.";
		TLTOARRVECTOR(checklength,text,aFile);
		
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "3.На недоліки, що були спричинені внаслідок недбалого поводження (включно, без обмеження, пошкодження, що заподіяні гострими предметами, вигинанням, стисканням, падінням, контактом з рідиною,";
		text[""] = text[""] & " вогнем тощо), чи спричинені неправильним використанням виробу, включаючи використання всупереч інструкціям, що супроводжують виріб.";

		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "4.На пошкодження, спричинені землетрусами, нещасними випадками, дією непереборних сил, впливом на виріб магнітного чи іншого шкідливого випромінювання, потраплянням всередину виробу сторонніх";
		text[""] = text[""] & " предметів, у тому числі комах, збоями в роботі або невідповідністю стандартам мереж електроживлення, навмисними або необережними діями з вашого боку, або з боку третіх осіб.";
    TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "5.Якщо виріб було відкрито, модифіковано або відремонтовано особою, що не є представником уповноваженого сервісного центру, якщо цей виріб відремонтовано звикористанням несанкціонованих запасних";
		text[""] = text[""] & " частин, коли серійний номер виробу було видалено, витерто, затерто, змінено, чи він є нерозбірливим, або у разі, якщо пошкодження виникли внаслідок обслуговування (включаючи оновлення та розширення).";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "6.На пошкодження, спричинені внаслідок використання виробу не у відповідності з опублікованими рекомендаціями компанії виробника.";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "7.Якщо виріб піддавався впливу зовнішніх факторів (наприклад корозії, окислюванню та ін.) або перебував поза дозволеного виробником діапазону температури, вологості та ін., який вказано в технічних";
		text[""] = text[""] & " специфікаціях, або на нього проливалася їжа або рідина, чи мали вплив хімічні речовини.";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "8.На дефекти, які виникли у зв’язку з нормальним зносом або нормальним старінням виробу.";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "9.На збережену інформацію та налаштування користувача (фотографії, музика, пошта, контакти та ін.)";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		
		text[""] = "Dyson не несе відповідальності за витрати, спричинені в результаті:";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "Використання деталей, не передбачених інструкцією Dyson.";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "Неакуратної експлуатації, переміщення або неналежного догляду";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "Вплив зовнішніх джерел, таких як перевезення або погодні умови.";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "Ремонт чи демонтаж деталей неуповноваженими особами чи представниками.";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "Експлуатації пилососу в інших, не побутових цілях.";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "Природного зношування, включаючи фільтр, щітку, шланг та електрошнур, або при встановленні";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "Факту зовнішнього пошкодження або неналежного звернення.";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "Використання неоригінальних деталей чи аксесуарів";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		addtexttoarea(SetBoldOn,aFile);
		addtexttoarea(SetUnderlineOn,aFile);
		TLTOARR(checklength,"Товар отримав у цілому стані та повній комплектації",aFile);
		TLTOARR(checklength,"3 умовами гарантії ознайомлений і згоден",aFile);
		addtexttoarea(SetBoldOff,aFile);
		addtexttoarea(SetUnderlineOff,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		TLTOARR(checklength,"========================================================",aFile);
		
		addtexttoarea(SetMiddleAlignment,aFile);
		TLTOARR(checklength,ORr.Addr0,aFile);
		
		addtexttoarea(chr(13) & chr(10),aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		//Cut receipt  
		addtexttoarea(chr(29) & chr(86) & "1",aFile);
end;


global 
updating procedure HandleSVOAct1(record SVOVc SVOr,var area aFile)		//Edit----------------------Dima  21.09.2015
begin
	string 10 SetLeftAlignment,SetRightAlignment,SetMiddleAlignment,SetTextSize,PrintImage;
	string 10 SetBoldOn,SetBoldOff,SetUnderlineOn,SetUnderlineOff;
	string 10 BigLetterOn,BigLetterOff,SmallLetterOn;
	string 100 s1,s2,s3, sTot,sVAT,sPay,SetFontA,SetFontB;
	string 200 Name,Address,Phone,eMail;
	integer rowLength;
	string 10 rebate;
	val sumreb;
	integer cjecklength;
	row SVOVc SVOrw;
	record UserVc USr;
	record SalesGroupVc SGr;
	
	
	cjecklength = 42;
	
	SetFontA = chr(27) & chr(33) & chr(0);
	SetFontB = chr(27) & chr(33) & chr(1);
	PrintImage = chr(28) & chr(112) & chr(1) & chr(00);
	SetLeftAlignment = chr(27) & chr(97) & "0";
	SetMiddleAlignment = chr(27) & chr(97) & "1";
	SetRightAlignment = chr(27) & chr(97) & "2";
	//SetTextSize = chr(29) & chr(33) & "1";
	SetBoldOn = chr(27) & chr(69) & "1";
	SetBoldOff = chr(27) & chr(69) & "0";
	SetUnderlineOn = chr(27) & chr(45) & "2";
	SetUnderlineOff = chr(27) & chr(45) & "0";
	BigLetterOn = chr(27) & chr(33)  & chr(32);
	SmallLetterOn = chr(27) & chr(33)  & chr(1);
	BigLetterOff = chr(27) & chr(33) & chr(0);
	
	rowLength = 32;
	
	SetAreaZeroSize(aFile);
	
	addtexttoarea(chr(13) & chr(10),aFile);
	//Rekviziti
	addtexttoarea(SetMiddleAlignment,aFile);
  addtexttoarea(SetBoldOn,aFile);
  TLTOARR(cjecklength,"Замовлення на обслуговування No " & SVOr.SerNr,aFile);
  addtexttoarea(SetBoldOff,aFile);

  addtexttoarea(SetLeftAlignment,aFile);
  SGr.SGroupCode = SVOr.SalesGroup;
  readfirstmain(SGr,1,true);
  if(nonblank(SGr.SGroupName))then begin
    TLTOARR(cjecklength,"Місце видачі: " & SGr.SGroupName,aFile);
  end;
  
  TLTOARR(cjecklength,"від: " & datetostring(SVOr.TransDate,"DD-YY-YYYY") & " " & SVOr.RegTime & "",aFile);
  addtexttoarea(chr(13) & chr(10),aFile);
  TLTOARR(cjecklength,"Сервісний центр :",aFile);
  TLTOARR(cjecklength,"Адреса: м.Київ, вул. Велика Васильківська 72",aFile);	
  TLTOARR(cjecklength,"ТЦ Олімпійський \"0 поверх\"",aFile);	
  //Kon Info
  TLTOARR(cjecklength,"__________________________________________",aFile);
  addtexttoarea(SetBoldOn,aFile);
  TLTOARR(cjecklength,"Контактна інформація",aFile);
  addtexttoarea(SetBoldOff,aFile);
  TLTOARR(cjecklength,"Власник: " & SVOr.Vlastnik,aFile);
  //TLTOARR(cjecklength,"Замовник: "& SVOr.Addr0,aFile);
  TLTOARR(cjecklength,"Конт.тел.: " & SVOr.Kontinfo1,aFile);
  TLTOARR(cjecklength,"E-Mail: " & SVOr.Kontinfo2,aFile);
  TLTOARR(cjecklength,"Адреса: " & SVOr.Kontinfo3,aFile);
  
  //DeagInf
  TLTOARR(cjecklength,"__________________________________________",aFile);
  addtexttoarea(SetBoldOn,aFile);
  TLTOARR(cjecklength,"Техніка прийнята у точці прийому",aFile);
  TLTOARR(cjecklength,"виріб:",aFile);
  addtexttoarea(SetBoldOff,aFile);
  matrowget(SVOr,0,SVOrw);
  TLTOARR(cjecklength,"Виробник: " & SVOr.Region,aFile);
  TLTOARR(cjecklength,"Серійний номер: " & SVOrw.SerialNr,aFile);
  TLTOARR(cjecklength,"Модель виробу: " & SVOrw.Spec,aFile);
  TLTOARR(cjecklength,"Батарея(з'ємна): " & SVOr.Batary,aFile);
  TLTOARR(cjecklength,"Зар.пристрій: " & SVOr.Zaryadka,aFile);
  TLTOARR(cjecklength,"Інше: " & SVOr.Inshe,aFile);
  TLTOARR(cjecklength,"Гарантія: " & SVOr.Garanty,aFile);

  //nespravnost
  TLTOARR(cjecklength,"__________________________________________",aFile);
  addtexttoarea(SetBoldOn,aFile);
  TLTOARR(cjecklength,"Несправності зі слів замовника:",aFile);
  addtexttoarea(SetBoldOff,aFile);
  TLTOARR(0,SVOr.Comment1,aFile);
  TLTOARR(0,SVOr.Comment2,aFile);
  addtexttoarea(SetBoldOn,aFile);
  TLTOARR(cjecklength,"Зовнішній вигляд та наявні дефекти:",aFile);
  addtexttoarea(SetBoldOff,aFile);
  TLTOARR(0,SVOr.Comment3,aFile);
  TLTOARR(0,SVOr.Comment4,aFile);
  
  TLTOARR(cjecklength,"__________________________________________",aFile);
  addtexttoarea(chr(13) & chr(10),aFile);
  TLTOARR(cjecklength,"- Обладнання прийнято для передачі в",aFile);
  TLTOARR(cjecklength,"сервісний центр iStore",aFile);
  addtexttoarea(chr(13) & chr(10),aFile);
  TLTOARR(cjecklength,"Якщо протягом Гарантійного періоду ви",aFile);
  TLTOARR(cjecklength,"звертаєтеся до компанії iStore на",aFile);
  TLTOARR(cjecklength,"підставі цієї гарантії,",aFile);
  TLTOARR(cjecklength,"компанія iStore на власний розсуд:",aFile);
  addtexttoarea(chr(13) & chr(10),aFile);
  TLTOARR(cjecklength,"(1) відремонтує Продукт, застосувавши",aFile);
  TLTOARR(cjecklength,"нові або раніше використовувані деталі,",aFile);
  TLTOARR(cjecklength,"які були перевірені та відповідають",aFile);
  TLTOARR(cjecklength,"функціональним вимогам; або",aFile);
  addtexttoarea(chr(13) & chr(10),aFile);
  TLTOARR(cjecklength,"(2) замінить Продукт таким самим продуктом",aFile);
  TLTOARR(cjecklength,"(або,за вашою згодою, таким, що має",aFile);
  TLTOARR(cjecklength,"аналогічні чи в цілому подібні",aFile);
  TLTOARR(cjecklength,"характеристики, що й оригінальний продукт,",aFile);
  TLTOARR(cjecklength,"наприклад іншою моделлю з тими самими",aFile);
  TLTOARR(cjecklength,"функціями або тією самою моделлю іншого",aFile);
  TLTOARR(cjecklength,"кольору), який є новим або складається",aFile);
  TLTOARR(cjecklength,"з нових і/або раніше використовуваних",aFile);
  TLTOARR(cjecklength,"оригінальних деталей, що були перевірені",aFile);
  TLTOARR(cjecklength,"та відповідають функціональним вимогам",aFile);
  TLTOARR(cjecklength,"; або",aFile);
  addtexttoarea(chr(13) & chr(10),aFile);
  TLTOARR(cjecklength,"(3) поверне вам витрачені кошти в обмін на",aFile);
  TLTOARR(cjecklength,"дефектний Продукт.",aFile);
  addtexttoarea(chr(13) & chr(10),aFile);
  TLTOARR(cjecklength,"- Під час оформлення замовлення прово-",aFile);
  TLTOARR(cjecklength,"диться зовнішній огляд виробу на наявність",aFile);
  TLTOARR(cjecklength,"ознак порушення умов експлуатації.",aFile);
  TLTOARR(cjecklength,"Незначні, важкопомітні пошкодження,",aFile);
  TLTOARR(cjecklength,"потертості, подряпини, тріщини, сколи",aFile);
  TLTOARR(cjecklength,"можуть бути не зафіксовані при оформленні",aFile);
  TLTOARR(cjecklength,"замовлення, що не є підставою для",aFile);
  TLTOARR(cjecklength,"пред`явлення замовником вимог щодо",aFile);
  TLTOARR(cjecklength,"часткової або повної компенсації вартості",aFile);
  TLTOARR(cjecklength,"виробу, моральної шкоди тощо.",aFile);
  addtexttoarea(chr(13) & chr(10),aFile);

  TLTOARR(cjecklength,"- Діагностика обладнання виконується",aFile);
  TLTOARR(cjecklength,"протягом 3 робочих днів з моменту",aFile);
  TLTOARR(cjecklength,"підтвердження наявності дефекту у",aFile);
  TLTOARR(cjecklength,"сервісному центрі.",aFile);
  TLTOARR(cjecklength,"- Термін виконання гарантійного ремонту",aFile);
  TLTOARR(cjecklength,"становить 14 днів.",aFile);
  TLTOARR(cjecklength,"У випадку відсутності запчастин на складі",aFile);
  TLTOARR(cjecklength,"сервісного центру термін ремонту може бути",aFile);
  TLTOARR(cjecklength,"подовжено на 180 днів.",aFile);
  addtexttoarea(chr(13) & chr(10),aFile);

  //addtexttoarea(SetBoldOn,aFile);
  TLTOARR(cjecklength,"- Сервісний центр не несе відповідальності",aFile);
  TLTOARR(cjecklength,"за збереження будь-якої інформації,",aFile);
  TLTOARR(cjecklength,"програмного забезпечення, персональних",aFile);
  TLTOARR(cjecklength,"даних,налаштувань користувача при",aFile);
  TLTOARR(cjecklength,"проведенні будь-яких робіт з обладнанням",aFile);
  TLTOARR(cjecklength,"і не компенсує їх часткову або",aFile);
  TLTOARR(cjecklength,"повну втрату.",aFile);
  //addtexttoarea(SetBoldOff,aFile);
  addtexttoarea(chr(13) & chr(10),aFile);
  TLTOARR(cjecklength,"- Результат попереднього огляду не є",aFile);
  TLTOARR(cjecklength,"кінцевим, про виявлені в процесі",aFile);
  TLTOARR(cjecklength,"діагностики або ремонту несправності",aFile);
  TLTOARR(cjecklength," сервісний центр повідомляє додатково. ",aFile);
  TLTOARR(cjecklength,"- Датою завершення робіт за замовленням",aFile);
  TLTOARR(cjecklength,"вважається дата повідомлення клієнта",aFile);
  TLTOARR(cjecklength,"телефоном або шляхом смс-інформування.",aFile);
  addtexttoarea(chr(13) & chr(10),aFile);
  //addtexttoarea(SetBoldOn,aFile);
  TLTOARR(cjecklength,"- У випадку потрапляння рідини, комах,",aFile);
  TLTOARR(cjecklength,"механічних пошкоджень сервіс-центр не несе ",aFile);
  TLTOARR(cjecklength,"відповідальності за працездатність",aFile);
  TLTOARR(cjecklength,"пристрою до та після його ремонту.",aFile);
  //addtexttoarea(SetBoldOff,aFile);
  addtexttoarea(chr(13) & chr(10),aFile);
  TLTOARR(cjecklength,"- Сервісний центр не несе відповідальності",aFile);
  TLTOARR(cjecklength,"за роботу програм сторонніх виробників,",aFile);
  TLTOARR(cjecklength,"активацію пристрою після оновлення ПЗ та",aFile);
  TLTOARR(cjecklength,"роботу додаткового сервісу «Знайти iPhone»",aFile);
  TLTOARR(cjecklength,"(Find my iPhone), iCloud, тощо.",aFile);
  addtexttoarea(chr(13) & chr(10),aFile);
  //addtexttoarea(SetBoldOn,aFile);
  TLTOARR(cjecklength,"- Сервісний центр не повертає Замовнику",aFile);
  TLTOARR(cjecklength,"замінені у процесі виконання замовлення",aFile);
  TLTOARR(cjecklength,"запасні частини, компоненти тощо. ",aFile);
  //addtexttoarea(SetBoldOff,aFile);
  addtexttoarea(chr(13) & chr(10),aFile);
  TLTOARR(cjecklength,"- Сервісний центр не несе будь-якої",aFile);
  TLTOARR(cjecklength,"відповідальності за цілісність дисплейного",aFile);
  TLTOARR(cjecklength,"модулю/скла у випадках,",aFile);
  TLTOARR(cjecklength,"якщо пристрій має будь-які механічні",aFile);
  TLTOARR(cjecklength,"пошкодження, сліди некваліфікованого",aFile);
  TLTOARR(cjecklength,"втручання або використання неоригінальних",aFile);
  TLTOARR(cjecklength,"витратних матеріалів для ремонту. ",aFile);
  addtexttoarea(SetBoldOff,aFile);
  TLTOARR(cjecklength,"__________________________________________",aFile);
  TLTOARR(cjecklength,"\"З правилами обслуговування та тарифами ",aFile);
  TLTOARR(cjecklength,"ознайомлений і згоден. Прошу виконати",aFile);
  TLTOARR(cjecklength,"діагностику, а у випадку необхідності,",aFile);
  TLTOARR(cjecklength,"ремонт мого обладнання. Своїм підписом я",aFile);
  TLTOARR(cjecklength,"також даю згоду на зберігання та обробку",aFile);
  TLTOARR(cjecklength,"моїх персональних даних, інформування мене",aFile);
  TLTOARR(cjecklength,"про новини та діючі акції сервісного",aFile);
  TLTOARR(cjecklength,"центру шляхом смс-повідомлень, електронних",aFile);
  TLTOARR(cjecklength,"повідомлень (e-mail) тощо.\"",aFile);
  addtexttoarea(chr(13) & chr(10),aFile);
  TLTOARR(cjecklength,"Власник: " & SVOr.Vlastnik,aFile);
  TLTOARR(cjecklength,"__________________________________________",aFile);

  addtexttoarea(chr(13) & chr(10),aFile);
  TLTOARR(cjecklength,"Обладнання до ремонту прийняв(ла):",aFile);
  USr.Code = SVOr.SalesMan;
  readfirstmain(USr,1,true);
  TLTOARR(cjecklength,USr.Name,aFile);
  TLTOARR(cjecklength,"__________________________________________",aFile);
  addtexttoarea(chr(13) & chr(10),aFile);
  TLTOARR(cjecklength,"\"Моїм підписом я підтверджую, що сервісний",aFile);
  TLTOARR(cjecklength,"центр " & Name & " виконав свої",aFile);
  TLTOARR(cjecklength,"зобов'язання з усунення заявлених ",aFile);
  TLTOARR(cjecklength,"недоліків.",aFile);
  TLTOARR(cjecklength,"Обладнання з ремонту отримано у",aFile);
  TLTOARR(cjecklength,"вищезазначеній комплектності.",aFile);
  TLTOARR(cjecklength,"З умовами надання гарантії на виконаний",aFile);
  TLTOARR(cjecklength,"ремонт ознайомлений і згоден.",aFile);
  TLTOARR(cjecklength,"Претензій до зовнішнього вигляду",aFile);
  TLTOARR(cjecklength,"пристрою не маю.\"",aFile);
  addtexttoarea(chr(13) & chr(10),aFile);
  TLTOARR(cjecklength,SVOr.Vlastnik,aFile);
  TLTOARR(cjecklength,"__________________________________________",aFile);
  TLTOARR(cjecklength," ",aFile);
  addtexttoarea(chr(13) & chr(10),aFile);
  TLTOARR(cjecklength," ",aFile);
  TLTOARR(cjecklength," ",aFile);
  addtexttoarea(chr(13) & chr(10),aFile);
  //Cut receipt  
  addtexttoarea(chr(29) & chr(86) & "1",aFile);
  
end;

global 
updating procedure HandleSVOAct2(record SVOVc SVOr,var area aFile)		//Edit----------------------Dima  21.09.2015
begin
	string 10 SetLeftAlignment,SetRightAlignment,SetMiddleAlignment,SetTextSize,PrintImage;
	string 10 SetBoldOn,SetBoldOff,SetUnderlineOn,SetUnderlineOff;
	string 10 BigLetterOn,BigLetterOff,SmallLetterOn;
	string 100 s1,s2,s3, sTot,sVAT,sPay,SetFontA,SetFontB;
	string 200 Name,Address,Phone,eMail;
	integer rowLength;
	string 10 rebate;
	val sumreb;
	integer cjecklength;
	row SVOVc SVOrw;
	record UserVc USr;
	
	cjecklength = 42;
	
	PrintImage = chr(28) & chr(112) & chr(1) & chr(0);
	SetFontA = chr(27) & chr(33) & chr(0);
	SetFontB = chr(27) & chr(33) & chr(1);
	
	SetLeftAlignment = chr(27) & chr(97) & "0";
	SetMiddleAlignment = chr(27) & chr(97) & "1";
	SetRightAlignment = chr(27) & chr(97) & "2";
	//SetTextSize = chr(29) & chr(33) & "1";
	SetBoldOn = chr(27) & chr(69) & "1";
	SetBoldOff = chr(27) & chr(69) & "0";
	SetUnderlineOn = chr(27) & chr(45) & "2";
	SetUnderlineOff = chr(27) & chr(45) & "0";
	BigLetterOn = chr(27) & chr(33)  & chr(32);
	SmallLetterOn = chr(27) & chr(33)  & chr(1);
	BigLetterOff = chr(27) & chr(33) & chr(0);
	
	rowLength = 32;
	
	SetAreaZeroSize(aFile);

	//LOGO
	
	//addtexttoarea(PrintImage,aFile);
	//addtexttoarea(SetMiddleAlignment,aFile);
	//addtexttoarea("А-Сервіс",aFile);
	//addtexttoarea(chr(13) & chr(10),aFile);
	
	addtexttoarea(SetMiddleAlignment,aFile);
  addtexttoarea(SetBoldOn,aFile);
  TLTOARR(cjecklength,"Замовлення на обслуговування No " & SVOr.SerNr,aFile);
  addtexttoarea(SetBoldOff,aFile);
  addtexttoarea(SetLeftAlignment,aFile);
  TLTOARR(cjecklength,"Сервісний центр :",aFile);
	TLTOARR(cjecklength,"          Телефон: 0 800 330 334",aFile);	
  TLTOARR(cjecklength,"Адреса: м.Київ, вул. Велика Васильківська 72",aFile);	
  TLTOARR(cjecklength,"ТЦ Олімпійський \"0 поверх\"",aFile);	
  

  TLTOARR(cjecklength," від: " & SVOr.TransDate & " " & SVOr.RegTime & "",aFile);
  
  
  
  //Kon Info
  TLTOARR(cjecklength,"__________________________________________",aFile);
  addtexttoarea(SetBoldOn,aFile);
  TLTOARR(cjecklength,"Контактна інформація",aFile);
  addtexttoarea(SetBoldOff,aFile);
  TLTOARR(cjecklength,"Власник: " & SVOr.Vlastnik,aFile);
  //TLTOARR(cjecklength,"Замовник: "& SVOr.Addr0,aFile);
  TLTOARR(cjecklength,"Конт.тел.: " & SVOr.Kontinfo1,aFile);
  TLTOARR(cjecklength,"E-Mail: " & SVOr.Kontinfo2,aFile);
  TLTOARR(cjecklength,"Адреса: " & SVOr.Kontinfo3,aFile);
  
  //DeagInf
  TLTOARR(cjecklength,"__________________________________________",aFile);
  addtexttoarea(SetBoldOn,aFile);
  TLTOARR(cjecklength,"Сервісний центр прийняв на діагностику",aFile);
  TLTOARR(cjecklength,"виріб:",aFile);
  addtexttoarea(SetBoldOff,aFile);
  matrowget(SVOr,0,SVOrw);
  TLTOARR(cjecklength,"Виробник: " & SVOr.Region,aFile);
  TLTOARR(cjecklength,"Серійний номер: " & SVOrw.SerialNr,aFile);
  TLTOARR(cjecklength,"Модель виробу: " & SVOrw.Spec,aFile);
  TLTOARR(cjecklength,"Батарея(з'ємна): " & SVOr.Batary,aFile);
  TLTOARR(cjecklength,"Зар.пристрій: " & SVOr.Zaryadka,aFile);
  TLTOARR(cjecklength,"Інше: " & SVOr.Inshe,aFile);
  TLTOARR(cjecklength,"Гарантія: " & SVOr.Garanty,aFile);
  
  //nespravnost
  TLTOARR(cjecklength,"__________________________________________",aFile);
  addtexttoarea(SetBoldOn,aFile);
  TLTOARR(cjecklength,"Несправності зі слів замовника:",aFile);
  addtexttoarea(SetBoldOff,aFile);
  TLTOARR(0,SVOr.Comment1,aFile);
  TLTOARR(0,SVOr.Comment2,aFile);
  addtexttoarea(SetBoldOn,aFile);
  TLTOARR(cjecklength,"Зовнішній вигляд та наявні дефекти:",aFile);
  addtexttoarea(SetBoldOff,aFile);
  TLTOARR(0,SVOr.Comment3,aFile);
  TLTOARR(0,SVOr.Comment4,aFile);
  
  addtexttoarea(chr(13) & chr(10),aFile);
  TLTOARR(cjecklength,"Обладнання до ремонту прийняв(ла):",aFile);
  USr.Code = SVOr.SalesMan;
  readfirstmain(USr,1,true);
  TLTOARR(cjecklength,USr.Name,aFile);
  TLTOARR(cjecklength,"__________________________________________",aFile);
  addtexttoarea(chr(13) & chr(10),aFile);
  
  TLTOARR(cjecklength,"- Обладнання прийнято для передачі в сервісний центр iStore",aFile);
  TLTOARR(cjecklength,"Якщо протягом Гарантійного періоду ви",aFile);
  TLTOARR(cjecklength,"звертаєтеся до компанії iStore на",aFile);
  TLTOARR(cjecklength,"підставі цієї гарантії,",aFile);
  TLTOARR(cjecklength,"компанія iStore на власний розсуд:",aFile);
  addtexttoarea(chr(13) & chr(10),aFile);
  TLTOARR(cjecklength,"(1) відремонтує Продукт, застосувавши",aFile);
  TLTOARR(cjecklength,"нові або раніше використовувані деталі,",aFile);
  TLTOARR(cjecklength,"які були перевірені та відповідають ",aFile);
  TLTOARR(cjecklength,"функціональним вимогам; або",aFile);
  addtexttoarea(chr(13) & chr(10),aFile);
  TLTOARR(cjecklength,"(2) замінить Продукт таким самим продуктом",aFile);
  TLTOARR(cjecklength,"(або,за вашою згодою, таким, що має",aFile);
  TLTOARR(cjecklength,"аналогічні чи в цілому подібні",aFile);
  TLTOARR(cjecklength,"характеристики, що й оригінальний продукт,",aFile);
  TLTOARR(cjecklength,"наприклад іншою моделлю з тими самими",aFile);
  TLTOARR(cjecklength,"функціями або тією самою моделлю іншого",aFile);
  TLTOARR(cjecklength,"кольору), який є новим або складається",aFile);
  TLTOARR(cjecklength,"з нових і/або раніше використовуваних",aFile);
  TLTOARR(cjecklength,"оригінальних деталей, що були перевірені",aFile);
  TLTOARR(cjecklength,"та відповідають функціональним вимогам",aFile);
  TLTOARR(cjecklength,"; або",aFile);
  addtexttoarea(chr(13) & chr(10),aFile);
  TLTOARR(cjecklength,"(3) поверне вам витрачені кошти в обмін на",aFile);
  TLTOARR(cjecklength,"дефектний Продукт.",aFile);
  addtexttoarea(chr(13) & chr(10),aFile);
  
  TLTOARR(cjecklength," ",aFile);
  TLTOARR(cjecklength," ",aFile);
  addtexttoarea(chr(13) & chr(10),aFile);
  //Cut receipt  
  addtexttoarea(chr(29) & chr(86) & "1",aFile);
  
end;






//Самый главный гарталон.
global 
updating procedure HandleBixolonWarrantyMain(record ORVc ORr,var area aFile,boolean bixolonnewimg)
begin
	string 10 SetLeftAlignment,SetRightAlignment,SetMiddleAlignment,SetTextSize,PrintImage;
	string 10 SetBoldOn,SetBoldOff,SetUnderlineOn,SetUnderlineOff;
	string 10 BigLetterOn,BigLetterOff,SmallLetterOn;
	string 100 SetFontA,SetFontB,filename;
	string 10 rebate;
	val sumreb;
	integer checklength,rwcnt,i;
	row ORVc ORrw;
	integer k;
	vector string 255 text;
	string 255 tax_url;
	area qrArea;
	longint alen,ai;
	date selldate;
	record INVc INr;
	record IVVc IVr;
	record SHVc SHr;

	
	checklength = 56;
	
	SetFontA = chr(27) & chr(33) & chr(0);
	SetFontB = chr(27) & chr(33) & chr(1);
	SetLeftAlignment = chr(27) & chr(97) & "0";
	SetMiddleAlignment = chr(27) & chr(97) & "1";
	SetRightAlignment = chr(27) & chr(97) & "2";
	SetBoldOn = chr(27) & chr(69) & "1";
	SetBoldOff = chr(27) & chr(69) & "0";
	SetUnderlineOn = chr(27) & chr(45) & "2";
	SetUnderlineOff = chr(27) & chr(45) & "0";
	BigLetterOn = chr(27) & chr(33)  & chr(32);
	SmallLetterOn = chr(27) & chr(33)  & chr(1);
	BigLetterOff = chr(27) & chr(33) & chr(0);
	PrintImage = chr(28) & chr(112) & chr(1) & chr(0);
	
	
	if(bixolonnewimg)then begin
	  PrintImage = chr(29) & chr(40) & chr(76) & chr(6) &  chr(0) & chr(48) & chr(69) & chr(48) & chr(48) & chr(1) & chr(1);
	end;
		
	  selldate = ORr.OrdDate;
    IVr.OrderNr = ORr.SerNr;
    if(readfirstkey("OrderNr",IVr,1,true))then begin
      selldate = IVr.InvDate;
    end;
    SHr.OrderNr = ORr.SerNr;
    if (ReadLastKey("OrderKey",SHr,1,true)) then begin
      selldate = SHr.ShipDate;
    end;
        
		addtexttoarea(PrintImage,aFile);
		
		addtexttoarea(SetFontB,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		addtexttoarea(SetMiddleAlignment,aFile);
		addtexttoarea(SetBoldOn,aFile);
		TLTOARR(checklength,"ГАРАНТІЙНИЙ ТАЛОН",aFile);
		addtexttoarea(SetBoldOff,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		addtexttoarea(SetLeftAlignment,aFile);
		
		rwcnt = MatRowCnt(ORr);
	  for(i=0;i<rwcnt;i=i+1) begin
      MatRowGet(ORr,i,ORrw);
      if(ORrw.stp==kInvoiceRowTypeNormal)then begin
        INr.Code = ORrw.ArtCode;
        readfirstmain(INr,1,true);
        if(ORrw.GarantyFor>0 and INr.ItemType==1)then begin
          addtexttoarea(SetUnderlineOff,aFile);
          TLTOARR(checklength,"НАЗВА ТОВАРУ:",aFile);
          addtexttoarea(SetUnderlineOn,aFile);
          TLTOARR(checklength,ORrw.Spec,aFile);
        
          addtexttoarea(SetUnderlineOff,aFile);
          TLTOARR(checklength,"СЕРІЙНИЙ НОМЕР: " & ORrw.SerialNr,aFile);
        
        
        
        
          TLTOARR(checklength,"ДАТА ПРОДАЖУ: " & selldate,aFile);
          TLTOARR(checklength,"ДАТА ЗАКІНЧЕННЯ ГАРАНТІЙНОГО ТЕРМІНУ:" & addmonth(selldate,ORrw.GarantyFor),aFile);
          addtexttoarea(SetBoldOn,aFile);
          TLTOARR(checklength,"ТЕРМІН ГАРАНТІЇ (МІСЯЦІВ): " & ORrw.GarantyFor,aFile);
          TLTOARR(checklength,"ТЕРМІН ГАРАНТІЇ НА АКСЕСУАРИ (ДНIВ): 14",aFile);
          addtexttoarea(chr(13) & chr(10),aFile);
        end;
      end;
		end;
		
		addtexttoarea(SetBoldOff,aFile);
		
		addtexttoarea(chr(13) & chr(10),aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
    
    text[""] = "Гарантійний термін  експлуатації виробу дорівнює гарантійному строку. Строк гарантії відраховується з дати роздрібного продажу споживачеві.";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "У разі виявлення несправностей, для здійснення діагностики та ремонту, просимо Вас звертатися в магазин, в якому була здійснена покупка або сервісний центр:";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		text[""] = "Сервісний центр:";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "        Адреса: м.Київ, вул. Велика Васильківська 72,";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "        ТЦ Олімпійський \"0 поверх\"";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "        Телефон: 0 800 330 334";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
    
    text[""] = "Магазини iStore:";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "        Телефон: 0 800 330 334";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "        Веб-сайт:";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "        www.istore.ua/ua/stores";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
				
		
		text[""] = "ДІЇ КОМПАНІЇ iStore У РАЗІ ОТРИМАННЯ ГАРАНТІЙНОЇ ПРЕТЕНЗІЇ";
		TLTOARRVECTOR(checklength,text,aFile);
    addtexttoarea(chr(13) & chr(10),aFile);
    
    text[""] = "Якщо протягом Гарантійного періоду ви звертаєтеся до компанії iStore на підставі цієї гарантії, компанія iStore на власний розсуд:";
		TLTOARRVECTOR(checklength,text,aFile);
    addtexttoarea(chr(13) & chr(10),aFile);
    
    text[""] = "(1) відремонтує Продукт, застосувавши нові або раніше використовувані деталі, які були перевірені та відповідають функціональним вимогам; або";
		TLTOARRVECTOR(checklength,text,aFile);
    addtexttoarea(chr(13) & chr(10),aFile);
    
    text[""] = "(2) замінить Продукт таким самим продуктом (або, за вашою згодою, таким, що має аналогічні чи в цілому подібні характеристики, що й оригінальний продукт, наприклад іншою моделлю з тими самими функціями або тією самою моделлю іншого кольору), який є новим або складається з нових і/або раніше використовуваних оригінальних деталей, що були перевірені та відповідають функціональним вимогам; або ";
		TLTOARRVECTOR(checklength,text,aFile);
    addtexttoarea(chr(13) & chr(10),aFile);
    
    text[""] = "(3) поверне вам витрачені кошти в обмін на дефектний Продукт.";
		TLTOARRVECTOR(checklength,text,aFile);
    addtexttoarea(chr(13) & chr(10),aFile);
		
		
		text[""] = "ЦЯ ГАРАНТІЯ ПОКРИВАЄ";
		TLTOARRVECTOR(checklength,text,aFile);
    addtexttoarea(chr(13) & chr(10),aFile);
    
    text[""] = "На пристрій, внутрішні деталі (компоненти), що вийшли з ладу не з вини користувача, і не мають пошкоджень, не були відремонтовані, та/або модифіковані.";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
    addtexttoarea(chr(13) & chr(10),aFile);
    
    
		addtexttoarea(SetBoldOn,aFile);
		addtexttoarea(SetUnderlineOff,aFile);
		TLTOARR(checklength,"ЦЯ ГАРАНТІЯ НЕ РОЗПОВСЮДЖУЄТЬСЯ",aFile);
		addtexttoarea(SetBoldOff,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "1.На косметичні пошкодження, включаючи, окрім іншого, подряпини, вм’ятини, та зламані пластикові деталі портів.";
		TLTOARRVECTOR(checklength,text,aFile);
		
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "2.На пошкодження, викликані використанням виробів інших фірм.";
		TLTOARRVECTOR(checklength,text,aFile);
		
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "3.На недоліки, що були спричинені внаслідок недбалого поводження (включно, без обмеження, пошкодження, що заподіяні гострими предметами, вигинанням, стисканням, падінням, контактом з рідиною,";
		text[""] = text[""] & " вогнем тощо), чи спричинені неправильним використанням виробу, включаючи використання всупереч інструкціям, що супроводжують виріб.";

		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "4.На пошкодження, спричинені землетрусами, нещасними випадками, дією непереборних сил, впливом на виріб магнітного чи іншого шкідливого випромінювання, потраплянням всередину виробу сторонніх";
		text[""] = text[""] & " предметів, у тому числі комах, збоями в роботі або невідповідністю стандартам мереж електроживлення, навмисними або необережними діями з вашого боку, або з боку третіх осіб.";
    TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "5.Якщо виріб було відкрито, модифіковано або відремонтовано особою, що не є представником уповноваженого сервісного центру, якщо цей виріб відремонтовано звикористанням несанкціонованих запасних";
		text[""] = text[""] & " частин, коли серійний номер виробу було видалено, витерто, затерто, змінено, чи він є нерозбірливим, або у разі, якщо пошкодження виникли внаслідок обслуговування (включаючи оновлення та розширення).";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "6.На пошкодження, спричинені внаслідок використання виробу не у відповідності з опублікованими рекомендаціями компанії виробника.";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "7.Якщо виріб піддавався впливу зовнішніх факторів (наприклад корозії, окислюванню та ін.) або перебував поза дозволеного виробником діапазону температури, вологості та ін., який вказано в технічних";
		text[""] = text[""] & " специфікаціях, або на нього проливалася їжа або рідина, чи мали вплив хімічні речовини.";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "8.На дефекти, які виникли у зв’язку з нормальним зносом або нормальним старінням виробу.";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "9.На збережену інформацію та налаштування користувача (фотографії, музика, пошта, контакти та ін.)";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
	  text[""] = "Гарантія від iStore - це турбота про час";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		addtexttoarea(SetMiddleAlignment,aFile);
    tax_url = "https://www.istore.ua/ua/istore-care/";
    getQRCode(tax_url,qrArea);
    if(getarealength(qrArea)>100)then begin
      alen = CountLinesInArea(qrArea);
      for(ai=0;ai<alen;ai=ai+1)begin
        text[""] = convertstringfromcodepage("WINDOWS-1251",GetLineFromArea(qrArea,ai));
        addtexttoarea(text[""],aFile);
      end;
    end;
		addtexttoarea(SetLeftAlignment,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		
		text[""] = "Обмежена гарантія Apple";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		addtexttoarea(SetMiddleAlignment,aFile);
    tax_url = "https://www.apple.com/legal/warranty/products/emea-vad-universal-warranty-ukranian.html";
    getQRCode(tax_url,qrArea);
    if(getarealength(qrArea)>100)then begin
      alen = CountLinesInArea(qrArea);
      for(ai=0;ai<alen;ai=ai+1)begin
        text[""] = convertstringfromcodepage("WINDOWS-1251",GetLineFromArea(qrArea,ai));
        addtexttoarea(text[""],aFile);
      end;
    end;
		addtexttoarea(SetLeftAlignment,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);

		
		text[""] = "ОБМІН ТА ПОВЕРНЕННЯ ТОВАРУ";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		text[""] = "Споживач перед придбанням товару перевіряє його комплектацію, відсутність пошкоджень або дефектів.";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "Обмін або повернення товару належної якості здійснюється протягом 14 днів.";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "Будь ласка, зверніть увагу, обміну або поверненню підлягає тільки новий товар, який не активований, який не був в експлуатації і не має слідів використання.";
		text[""] = text[""]  & " Обов`язково повинно бути збережено: повний комплект товару, цілісність, неушкодженість та всі частини упаковки, ярлики, захисні плівки, заводське маркування.";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
 
		
		
		addtexttoarea(SetBoldOn,aFile);
		addtexttoarea(SetUnderlineOn,aFile);
		TLTOARR(checklength,"Товар отримав у цілому стані та повній комплектації",aFile);
		TLTOARR(checklength,"3 умовами гарантії ознайомлений і згоден",aFile);
		addtexttoarea(SetBoldOff,aFile);
		addtexttoarea(SetUnderlineOff,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		TLTOARR(checklength,"========================================================",aFile);
		
		addtexttoarea(SetMiddleAlignment,aFile);
		TLTOARR(checklength,ORr.Addr0,aFile);
		
		addtexttoarea(chr(13) & chr(10),aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		//Cut receipt  
		addtexttoarea(chr(29) & chr(86) & "1",aFile);
		
		SetExportCodePage("CP1251");
		writeareatofile(aFile,"tmprec.txt",0);
		filename = makeuuid;
    RunProgram("./gen_rec.sh", filename);
    //if(currentuser=="SA")then begin
      EasySendTurboSMS(ORr.Phone,"Дякуємо за покупку. Гарантія на Ваші товари доступна за посиланням: " & "https://warranty.istore.ua/warranty/" & filename & ".html");
    //end;
end;



//Доп условия.
global 
updating procedure HandleBixolonWarrantyMainAdditional(record ORVc ORr,var area aFile,boolean bixolonnewimg)
begin
	string 10 SetLeftAlignment,SetRightAlignment,SetMiddleAlignment,SetTextSize,PrintImage;
	string 10 SetBoldOn,SetBoldOff,SetUnderlineOn,SetUnderlineOff;
	string 10 BigLetterOn,BigLetterOff,SmallLetterOn;
	string 100 SetFontA,SetFontB,filename;
	string 10 rebate;
	val sumreb;
	integer checklength,rwcnt,i;
	row ORVc ORrw;
	integer k;
	vector string 255 text;
	string 255 tax_url;
	area qrArea;
	longint alen,ai;
	date selldate;
	record IVVc IVr;
	record SHVc SHr;
	
	checklength = 56;
	
	SetFontA = chr(27) & chr(33) & chr(0);
	SetFontB = chr(27) & chr(33) & chr(1);
	SetLeftAlignment = chr(27) & chr(97) & "0";
	SetMiddleAlignment = chr(27) & chr(97) & "1";
	SetRightAlignment = chr(27) & chr(97) & "2";
	SetBoldOn = chr(27) & chr(69) & "1";
	SetBoldOff = chr(27) & chr(69) & "0";
	SetUnderlineOn = chr(27) & chr(45) & "2";
	SetUnderlineOff = chr(27) & chr(45) & "0";
	BigLetterOn = chr(27) & chr(33)  & chr(32);
	SmallLetterOn = chr(27) & chr(33)  & chr(1);
	BigLetterOff = chr(27) & chr(33) & chr(0);
	PrintImage = chr(28) & chr(112) & chr(1) & chr(0);
	
	  addtexttoarea(SetFontA,aFile);
		addtexttoarea(SetLeftAlignment,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
    
    addtexttoarea(chr(13) & chr(10),aFile);
		text[""] = "Гарантія від iStore 12 або 24 місяці -";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "це турбота про Ваш пристрій.";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		text[""] = "ДОДАТКОВА ГАРАНТІЯ iStore (додаткова оплата)";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "ДОДАТКОВА гарантія для iPhone, iPad та";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "Watch 12 або 24 місяці.";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "Гарантійне обслуговування.";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "-У разі підтвердження заводського дефекту";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "сервісним центром, ми зробимо заміну";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "пристрою на новий, протягом";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "1-5 робочих днів.";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "-Повне налаштування та підтримка нового";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "пристрою.";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "-Безкоштовне захисне скло Base або";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "преміальне захисне скло зі знижкою";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "у 10% на iPhone або iPad.";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "+ пакет захисту дисплею iPhone";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		
		text[""] = "-Одноразова безкоштовна заміна дисплею";
		TLTOARRVECTOR(checklength,text,aFile);		
		text[""] = "або скла*";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "-Безкоштовна заміна АКБ, якщо його";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "ємність менше 79%*";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "-Знижка 10% на преміальне захисне скло";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "для iPhone";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		text[""] = "*інші пошкодження не покриваються цим";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "пакетом захисту та будуть відремонтовані";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "згідно з розцінками сервісного центру";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		text[""] = "*не виключено для виконання ремонту";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "передбаченим даним пакетом потрібно";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "усунути дефекти які не входять";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "до плану захист";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "ДОДАТКОВА гарантія iStore";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "для Mac 12 або 24 місяців";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "12 місяців гарантії від заводських";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "дефектів для Mac.";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "-Знижка 10% на ремонт, при негарантійному";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "випадку.";
		TLTOARRVECTOR(checklength,text,aFile);
//		text[""] = "-Безкоштовна встановлення Microsoft Office";
//		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "-Безкоштовна чистка від пилу з заміною";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "термопасти один раз на час дiї пакету.";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "-Безкоштовна технічна консультація";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "впродовж всього гарантійного терміну.";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		text[""] = "впродовж всього гарантійного терміну.";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "+ пакет захисту MacBook";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "У разі винекнення пошкодження, Ви можете";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "полагадити свій Mac, але не більше трьох";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "звернень за календарний рік, додатково,";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "у разі настаня сервісного випадку";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "стягується комісія за обслуговування";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "у розмірі:";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "+4999 грн за пошкодження екрану чи";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "зовнішнього корпусу";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "+10999 грн. за інше випадкове пошкодження.";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "Усунення пошкоджень проводитися в";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "сервісному центрі, відповідно";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "до регламенту. ";
		TLTOARRVECTOR(checklength,text,aFile);		
		text[""] = "Сервісний центр на власний розсуд виконує";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "ремонт чи заміну несправного модуля.";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "ДОДАТКОВА гарантія iStore для AirPods";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "Гарантійне обслуговування.";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "-У разі виявлення заводського дефекту,";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "ми зробимо заміну непрацюючого елементу";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "на новий, протягом 1-5 робочих днів.";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "-Налаштування та підтримка нового пристрою";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "-Одна безкоштовна чистка протягом дії";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "пакету.";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "-Налаштування підписки AppleMusic.";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		
		text[""] = "+ пакет захисту AirPods";
		TLTOARRVECTOR(checklength,text,aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
				
		text[""] = "Гарантійне обслуговування, пов’язане";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "з будь-яким заводськими дефектом або";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "механічними пошкодженнями.";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "Гарантійне обслуговування. У разі";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "виявлення заводського дефекту, ми";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "зробимо заміну непрацюючого елементу";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "на новий, протягом 1-5 робочих днів.";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "Однарозова заміна при механічних";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "пошкодженнях, такі як (попадання";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "вологи, незначні тріщини, потертості)";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "ми зробимо заміну пошкодженого";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "елементу на новий, протягом";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "1-5 днів. *";
		TLTOARRVECTOR(checklength,text,aFile);
		text[""] = "* не покриває втрату";
		TLTOARRVECTOR(checklength,text,aFile);
		
		
		addtexttoarea(chr(13) & chr(10),aFile);
		
		
		//Cut receipt  
		addtexttoarea(chr(13) & chr(10),aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		addtexttoarea(chr(13) & chr(10),aFile);
		addtexttoarea(chr(29) & chr(86) & "1",aFile);
		
		SetExportCodePage("CP1251");
		writeareatofile(aFile,"tmprec.txt",0);
		filename = makeuuid;
    RunProgram("./gen_rec.sh", filename);
    EasySendTurboSMS(ORr.Phone,"Дякуємо за покупку. Гарантія на Ваші товари доступна за посиланням: " & "https://warranty.istore.ua/warranty/" & filename & ".html");
end;